// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/assignHelper","../../../Color","./support/colors","./support/utils"],function(a,o,e,t,r,i){function n(a,o){return a.map(function(a){var e=new t(a);return null!=o&&(e.a=o),e})}function l(a,o,e,i){var l,c=r[a],s=n(c.stops);if(c)switch(i){case"point":case"multipoint":if("point-cloud-class"===e)l={theme:e,colors:s};else{var p=o;l={theme:e,colors:s,noDataColor:new t(p.noDataColor),opacity:1,outline:{color:new t(p.outline.color),width:p.outline.width},size:p.size}}break;case"polyline":var m=o;l={theme:e,colors:s,noDataColor:new t(m.noDataColor),opacity:1,width:m.width};break;case"polygon":var h=o;l={theme:e,colors:s,noDataColor:new t(h.noDataColor),opacity:h.fillOpacity||1,outline:{color:new t(h.outline.color),width:h.outline.width}};break;case"mesh":var d=o;l={theme:e,colors:s,noDataColor:new t(d.noDataColor),opacity:d.fillOpacity||1}}return l}function c(a,o,e){var t=d[o],r=i.getStorageType(e),n=t&&t[r];return n&&n[a]}var s={light:{color:[153,153,153,.25],width:"1px"},dark:{color:[153,153,153,.25],width:"1px"},darker:{color:[26,26,26,.25],width:"1px"}},p={light:["streets","gray","topo","terrain","national-geographic","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},m=["tropical-bliss","desert-blooms","under-the-sea","vibrant-rainbow","ocean-bay","prairie-summer","pastel-chalk"],h={default:{name:"default",label:"Default",description:"Default theme for visualizing features by their type.",basemapGroups:p,pointSchemes:{light:{common:{noDataColor:"#aaaaaa",outline:s.light,size:"8px"},primary:"cat-dark",secondary:["cat-light"].concat(m)},dark:{common:{noDataColor:"#aaaaaa",outline:s.darker,size:"8px"},primary:"cat-light",secondary:["cat-dark"].concat(m)}},polylineSchemes:{light:{common:{noDataColor:"#aaaaaa",width:"2px"},primary:"cat-dark",secondary:["cat-light"].concat(m)},dark:{common:{noDataColor:"#aaaaaa",width:"2px"},primary:"cat-light",secondary:["cat-dark"].concat(m)}},polygonSchemes:{light:{common:{noDataColor:"#aaaaaa",outline:s.light,fillOpacity:.8},primary:"cat-dark",secondary:["cat-light"].concat(m)},dark:{common:{noDataColor:"#aaaaaa",outline:s.dark,fillOpacity:.8},primary:"cat-light",secondary:["cat-dark"].concat(m)}}},"point-cloud-class":{name:"point-cloud-class",label:"Point Cloud Class",description:"Default theme for visualizing point cloud data based on classification.",basemapGroups:p,pointSchemes:{light:{primary:"point-cloud-class-scheme",secondary:[]},dark:{primary:"point-cloud-class-scheme",secondary:[]}}}},d={};!function(){for(var a in h){var o=h[a],e=o.basemapGroups,t=d[a]={basemaps:[].concat(e.light).concat(e.dark),point:{},polyline:{},polygon:{}};for(var r in e)for(var i=e[r],n=0;n<i.length;n++){var l=i[n];o.pointSchemes&&(t.point[l]=o.pointSchemes[r]),o.polylineSchemes&&(t.polyline[l]=o.polylineSchemes[r]),o.polygonSchemes&&(t.polygon[l]=o.polygonSchemes[r])}}}();var u={getThemes:function(a){var o=[];for(var e in h){var t=h[e],r=d[e],n=i.getBasemapId(a,r.basemaps);n&&-1===r.basemaps.indexOf(n)||o.push({name:t.name,label:t.label,description:t.description,basemaps:r.basemaps.slice(0)})}return o},getSchemes:function(a){var o,e=a.geometryType,t="mesh"!==e&&a.worldScale,r=a.view,n=a.theme||"default",s=i.getBasemapId(a.basemap,d[n].basemaps),p=c(s,n,e);if(p){var m=l(p.primary,p.common,n,e);o={primaryScheme:t?u.toWorldScale({scheme:m,view:r}):m,secondarySchemes:p.secondary.map(function(a){var o=l(a,p.common,n,e);return t?u.toWorldScale({scheme:o,view:r}):o}),basemapId:s}}return o},cloneScheme:function(a){var o;return a&&(o=e({},a),o.colors=n(o.colors),o.noDataColor&&(o.noDataColor=new t(o.noDataColor)),o.outline&&(o.outline={color:o.outline.color&&new t(o.outline.color),width:o.outline.width})),o},toWorldScale:function(a){if(a.scheme&&a.view){var o=a.scheme,e=a.scheme;if(o.hasOwnProperty("size"))return o.size&&(o.size=i.toWorldScale(o.size,a.view)),o;if(e.hasOwnProperty("width"))return e.width&&(e.width=i.toWorldScale(e.width,a.view)),e}return a.scheme}};return u});