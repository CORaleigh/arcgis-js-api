// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","../../core/numberUtils","dojo/i18n!./nls/RendererSlider","dojo/dom-style","dojo/string","dijit/Tooltip","dojox/gfx"],function(e,t,o,i,a,n,r){return{histogramXAvgPadding:18,labelTopOffset:3,generateTransparentBackground:function(e,t,o,i){var a=e.createRect({width:t,height:o}).setFill(i?this.getTransparentFill():null);return a.moveToBack(),a},getTransparentFill:function(){return{type:"pattern",x:0,y:0,width:16,height:16,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgaGVpZ2h0PSIxNiIgd2lkdGg9IjE2Ij48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNjY2MiIC8+PHBhdGggZD0iTTAgMCBMOCAwIEw4IDggTDAgOCBaIiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDgpIiAvPjxwYXRoIGQ9Ik0wIDAgTDggMCBMOCA4IEwwIDggWiIgZmlsbD0iI2NjYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCw4KSIgLz48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgsMCkiIC8+PC9zdmc+"}},generateHistogramSurface:function(e,t,o,a){var n=r.createSurface(e,t,o);return i.set(n.rawNode,{overflow:"visible",display:"inline-block",left:a+"px"}),n.rawNode.setAttribute("class","esri-histogram-surface"),n},generateCountTooltips:function(e,t){var i,r=[];return i=(e.bins||[]).map(function(e){return"object"==typeof e?e.count:e}),i.reverse(),i.forEach(function(e,i){r.push(new n({connectId:[t.children[i].rawNode],label:a.substitute(o.count,{count:e})}))},this),r},generateHistogram:function(e,t,o,a,n){var s,l,c,d,p=e.createGroup();return p.rawNode.setAttribute("class","esri-histogram-group"),s=(t.bins||[]).map(function(e){return"object"==typeof e?e.count:e}),s.reverse(),l=e.getDimensions().height/s.length,s.forEach(function(e,t){c=e>0?(o-this.histogramXAvgPadding)*(e/Math.max.apply(Math,s)):0,d=p.createRect({width:c,height:l}).setFill("#aaa").setTransform(r.matrix.translate(0,l*t)),d.rawNode.setAttribute("class","esri-histogram-bar"),d.rawNode.setAttribute("shape-rendering","crispEdges")},this),i.set(e.rawNode,{display:"inline-block",left:a+"px"}),n||p.setTransform({dx:o,dy:0,xx:-1,xy:0,yx:0,yy:1}),p},generateAvgLine:function(r,s,l,c,d,p,g){var u,h,b,f=r.rawNode.getAttribute("width"),m=r.rawNode.getAttribute("height"),x=Math.round(l);return u=r.createLine({x1:d?0:14,y1:x,x2:d?f-this.histogramXAvgPadding+4:f,y2:x}).setStroke({color:"#667"}).moveToBack(),u.rawNode.setAttribute("shape-rendering","crispEdges"),h=r.createImage({x:d?f-this.histogramXAvgPadding+4+2:0,y:x-8,width:14,height:18,src:e.toUrl("./xAvg.svg")}),p?s=s:g?s=t.format(parseFloat(s.toFixed(2))).toString()+"%":(c=c<2?2:c,s=t.format(parseFloat(s.toFixed(c))).toString()),b=new n({connectId:[h.rawNode],label:a.substitute(o.statsAvg,{avg:s})}),x>m||x<0?(i.set(u.rawNode,"display","none"),i.set(h.rawNode,"display","none")):(i.set(u.rawNode,"display","block"),i.set(h.rawNode,"display","block")),{avgHandleLine:u,avgHandleImage:h,avgHandleTooltip:b}},getCombinedPrecision:function(e,t){var o=this.getPrecision(e),i=this.getPrecision(t);return e>-10&&e<10&&t>-10&&t<10&&o<2&&i<2?2:o>i?o:i},getPrecision:function(e){if(isNaN(e))return 0;for(var t,o=1;Math.round(e*o)/o!==e;)o*=10;return t=Math.round(Math.log(o)/Math.LN10),t>20?20:t},_resetLabelPositions:function(e){(e||[]).forEach(function(e){e&&e.labelNode&&(i.set(e.labelNode,"top","3px"),e.labelNode._autoPositioned=!1)})},_autoPositionHandleLabels:function(e){var t=[];if(0!==e.length&&(this._resetLabelPositions(e),(e||[]).forEach(function(e,o){e&&e.labelNode&&t.push({index:o,handle:e,label:e.labelNode,rect:e.labelNode.getBoundingClientRect()})}),0!==t.length))switch(t.length){case 1:break;case 2:this._autoPositionTwoHandles(e,t);break;case 3:this._autoPositionThreeHandles(e,t);break;default:this._autoPositionManyHandles(e,t)}},_autoPositionTwoHandles:function(e,t){var o,a,n,r;this.collisionCheck(t[0].rect,t[1].rect)&&(o=t[0].rect.top-t[1].rect.top,a=(t[0].rect.height-o)/2,n=this.labelTopOffset+a,r=this.labelTopOffset-a,i.set(t[0].label,"top",n+"px"),i.set(t[1].label,"top",r+"px"),t[0].label._autoPositioned=!0,t[1].label._autoPositioned=!0)},_autoPositionThreeHandles:function(e,t){var o,a,n,r,s,l,c;if(t.forEach(function(e,d){(c=t[d-1])&&c.rect&&this.collisionCheck(e.rect,c.rect)&&(e.label._autoPositioned&&!c.label._autoPositioned?(o=c.rect.top-e.rect.top,n=e.rect.height,r=n-o+this.labelTopOffset,i.set(c.label,"top",r+"px"),c.label._autoPositioned=!0):!e.label._autoPositioned&&c.label._autoPositioned?(o=c.rect.top-e.rect.top,n=e.rect.height,r=-1*(n-o)+Number(c.label.style.top.replace("px","")),i.set(e.label,"top",r+"px"),e.label._autoPositioned=!0):(o=c.rect.top-e.rect.top,a=(e.rect.height-o)/2,s=this.labelTopOffset-a,l=this.labelTopOffset+a,i.set(c.label,"top",l+"px"),i.set(e.label,"top",s+"px"),c.label._autoPositioned=!0,e.label._autoPositioned=!0))},this),t[2].handle&&t[2].handle.style.top.replace("px","")<10){var d,p,g,u,h=t[2].label,b=t[1].label,f=t[0].label,m=h.getBoundingClientRect(),x=b.getBoundingClientRect(),P=f.getBoundingClientRect();h._autoPositioned&&b._autoPositioned&&f._autoPositioned?(d=Number(h.style.top.replace("px",""))+8,p=Number(b.style.top.replace("px",""))+8,g=Number(f.style.top.replace("px",""))+8,i.set(h,"top",d+"px"),i.set(b,"top",p+"px"),i.set(f,"top",g+"px")):(h._autoPositioned&&(u=Number(h.style.top.replace("px",""))+4,i.set(h,"top",u+"px")),b._autoPositioned&&x.top-m.top<x.height&&(u=Number(b.style.top.replace("px",""))+4,i.set(b,"top",u+"px")),P.top-x.top<P.height&&(u=Number(f.style.top.replace("px",""))+4,i.set(f,"top",u+"px")))}},_autoPositionManyHandles:function(){},collisionCheck:function(e,t){return!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom)}}});