// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/assignHelper","../../../core/tsSupport/declareExtendsHelper","../../../core/tsSupport/decorateHelper","dojo/dom-construct","dojo/i18n!../nls/SymbolStyler","../../../Color","../../../symbols","../../../core/Accessor","../../../core/devEnvironmentUtils","../../../core/promiseUtils","../../../core/urlUtils","../../../core/accessorSupport/decorators","../../../symbols/support/gfxUtils","../../../symbols/support/jsonUtils","../../../symbols/support/styleUtils","../../../symbols/support/symbolUtils"],function(t,e,r,i,o,n,l,a,s,p,m,y,u,c,d,v,h,b){function S(t){var e=t.get("data.thumbnail.href"),r=t.data.title,i=n.create("div");if(m.isDevEnvironment()&&(e=m.adjustStaticAGOUrl(e)),!e)return i.appendChild(f(r)),y.resolve(i);var o=new s.WebStyleSymbol({name:t.data.name,styleUrl:t.portalItem.itemUrl+"/data",thumbnail:{url:e?u.makeAbsolute(e,t.get("portalItem.itemUrl")):null}}),l="flat"===t.data.dimensionality?24:48;return b.renderPreviewHTML(o,{node:i,size:l,disableUpsampling:!0}).then(function(t){return i}).catch(function(){return i.appendChild(f(r)),i})}function f(t){return void 0===t&&(t=l.noTitle),n.create("span",{innerHTML:t,alt:""})}function g(t,e,r){var i=h.styleNameFromItem(r),o=null;i||(o=r.itemUrl+"/data");var n={data:t,baseUrl:r.itemUrl,styleName:i,styleUrl:o};return h.fetchSymbolFromStyle(n,e,{portal:r.portal})}Object.defineProperty(e,"__esModule",{value:!0});var w=[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Triangle",type:"esriSMS",style:"esriSMSTriangle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],C=[{title:l.circle,name:"Circle",primitive:"circle"},{title:l.square,name:"Square",primitive:"square"},{title:l.cross,name:"Cross",primitive:"cross"},{title:l.x,name:"X",primitive:"x"},{title:l.kite,name:"Kite",primitive:"kite"},{title:l.triangle,name:"Triangle",primitive:"triangle"}],I=[{title:l.sphere,name:"Sphere",primitive:"sphere"},{title:l.tallCylinder,name:"Tall_Cylinder",primitive:"cylinder",mixins:{width:5,height:10,depth:5}},{title:l.cylinder,name:"Cylinder",primitive:"cylinder"},{title:l.tallCube,name:"Tall_Cube",primitive:"cube",mixins:{width:5,height:10,depth:5,anchor:"bottom"}},{title:l.cube,name:"Cube",primitive:"cube"},{title:l.tallCone,name:"Tall_Cone",primitive:"cone",mixins:{width:5,height:10,depth:5}},{title:l.cone,name:"Cone",primitive:"cone"},{title:l.invertedCone,name:"Inverted_Cone",primitive:"invertedCone"},{title:l.diamond,name:"Diamond",primitive:"diamond"},{title:l.tetrahedron,name:"Tetrahedron",primitive:"tetrahedron"}],_=C.map(function(t){return{dimensionality:"flat",name:t.name,title:t.title,type:"PointSymbol3D",symbolLayers:[{type:"Icon",resource:{primitive:t.primitive},material:{color:d.defaultThematicColor},outline:{color:[0,0,0]}}]}}),T=I.map(function(t){return{dimensionality:"volumetric",name:t.name,title:t.title,type:"PointSymbol3D",symbolLayers:[r({type:"Object",resource:{primitive:t.primitive}},t.mixins)]}}),M={getSymbol:function(t){var e=t.data,r=t.parentData,i=t.portalItem;return g(r,e.name,i).then(function(t){return"point-3d"===t.type&&t.symbolLayers.forEach(function(t){t.get("material.color")&&("icon"===t.type?t.material.color=d.defaultThematicColor.clone():"object"===t.type&&(t.material.color=t.material.color||new a([255,255,255])))}),t})},getThumbnail:function(t){return S(t)}},O={getSymbol:function(t){return y.resolve(v.fromJSON(t.data))},getThumbnail:function(t){return t.getSymbol().then(function(t){return b.renderPreviewHTML(t,{size:24})})}},U={getSymbol:function(t){return y.resolve(v.fromJSON(t.data))},getThumbnail:function(t){return t.getSymbol().then(function(t){return b.renderPreviewHTML(t,{size:48})})}},D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getSymbol=function(){var t=this;return this._symbol?y.resolve(this._symbol):this.strategy.getSymbol(this).then(function(e){return t._symbol=e})},e.prototype.getThumbnail=function(t){var e=this;if(this._thumbnail){t.appendChild(this._thumbnail);var r=Function.prototype;return y.resolve(r)}return this.strategy.getThumbnail(this).then(function(r){return e._thumbnail=r,function(){t.appendChild(e._thumbnail)}})},o([c.property()],e.prototype,"strategy",void 0),o([c.property()],e.prototype,"data",void 0),o([c.property()],e.prototype,"parentData",void 0),o([c.property()],e.prototype,"portalItem",void 0),e=o([c.subclass("esri.widgets.SymbolStyler.SymbolItem")],e)}(c.declared(p));e.SymbolItem=D;var P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.fetchData=function(){var t=this;return this.data?y.resolve(this.data):this.portalItem.fetchData().then(function(e){return t._set("data",e),e})},o([c.property({readOnly:!0})],e.prototype,"data",void 0),o([c.property({aliasOf:"portalItem.id"})],e.prototype,"id",void 0),o([c.property({aliasOf:"portalItem.name"})],e.prototype,"name",void 0),o([c.property({aliasOf:"portalItem.title"})],e.prototype,"title",void 0),o([c.property()],e.prototype,"portalItem",void 0),e=o([c.subclass("esri.widgets.SymbolStyler.PortalItemSymbolSourceBase")],e)}(c.declared(p)),j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="symbol-set",e}return i(e,t),e.prototype.getItems=function(){return y.resolve(null)},o([c.property({readOnly:!0})],e.prototype,"type",void 0),e=o([c.subclass("esri.widgets.SymbolStyler.SymbolSetSymbolSource")],e)}(c.declared(P));e.SymbolSetSymbolSource=j;var x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="web-style",e}return i(e,t),e.prototype.getItems=function(){var t=this;return this._items?y.resolve(this._items):this.fetchData().then(function(e){return e.items.map(function(r){return new D({data:r,parentData:e,portalItem:t.portalItem,strategy:M})})}).then(function(e){return t._items=e})},o([c.property({readOnly:!0})],e.prototype,"type",void 0),e=o([c.subclass("esri.widgets.SymbolStyler.WebStyleSymbolSource")],e)}(c.declared(P));e.WebStyleSymbolSource=x;var z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=w,e.id="basic-symbol-set",e.name="Basic",e.title=l.basic,e.type="symbol-set",e}return i(e,t),e.prototype.getItems=function(){return y.resolve(null)},o([c.property()],e.prototype,"data",void 0),o([c.property()],e.prototype,"id",void 0),o([c.property()],e.prototype,"name",void 0),o([c.property()],e.prototype,"title",void 0),o([c.property({readOnly:!0})],e.prototype,"type",void 0),e=o([c.subclass("esri.widgets.SymbolStyler.BasicSymbolSetSource")],e)}(c.declared(p));e.BasicSymbolSetSource=z;var H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data={items:_},e.id="basic-web-style:flat",e.name="Basic",e.title=l.basic,e.type="web-style",e}return i(e,t),e.prototype.getItems=function(){if(this._items)return y.resolve(this._items);var t=this.data.items.map(function(t){return new D({data:t,strategy:O})});return y.resolve(this._items=t)},o([c.property()],e.prototype,"data",void 0),o([c.property()],e.prototype,"id",void 0),o([c.property()],e.prototype,"name",void 0),o([c.property()],e.prototype,"title",void 0),o([c.property({readOnly:!0})],e.prototype,"type",void 0),e=o([c.subclass("esri.widgets.SymbolStyler.IconPrimitiveWebStyleSource")],e)}(c.declared(p));e.IconPrimitiveWebStyleSource=H;var L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data={items:T},e.id="basic-web-style:volumetric",e.name="Basic",e.title=l.basic,e.type="web-style",e}return i(e,t),e.prototype.getItems=function(){var t=this;if(this._items)return y.resolve(this._items);var e=this.data.items.map(function(e){return new D({data:e,parentData:t.data,strategy:U})});return y.resolve(this._items=e)},o([c.property()],e.prototype,"data",void 0),o([c.property()],e.prototype,"id",void 0),o([c.property()],e.prototype,"name",void 0),o([c.property()],e.prototype,"title",void 0),o([c.property({readOnly:!0})],e.prototype,"type",void 0),e=o([c.subclass("esri.widgets.SymbolStyler.ObjectPrimitiveWebStyleSource")],e)}(c.declared(p));e.ObjectPrimitiveWebStyleSource=L});