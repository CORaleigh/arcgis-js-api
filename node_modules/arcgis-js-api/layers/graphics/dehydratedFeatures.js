// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","exports","../../geometry","../../Graphic","../../core/compilerUtils","../../core/lang","../../core/typedArrayUtil","../../geometry/SpatialReference","../../geometry/support/aaBoundingBox","../../geometry/support/aaBoundingRect","../../geometry/support/quantizationUtils","../support/Field","./dehydratedFeatureComparison"],function(e,t,r,a,n,s,i,o,l,u,p,h,c){function y(e){return r.isFeatureGeometryType(e.type)}function m(e){return"point"===e.type}function f(e){var t=r.featureGeometryTypeKebabDictionary.fromJSON(e.geometryType),a=o.fromJSON(e.spatialReference),s=e.transform,i=e.features.map(function(r){var i=d(r,t,a,e.objectIdFieldName),o=i.geometry;if(o&&s)switch(o.type){case"point":i.geometry=p.hydratePoint(s,o,o,o.hasZ,o.hasM);break;case"multipoint":i.geometry=p.hydrateMultipoint(s,o,o,o.hasZ,o.hasM);break;case"polygon":i.geometry=p.hydratePolygon(s,o,o,o.hasZ,o.hasM);break;case"polyline":i.geometry=p.hydratePolyline(s,o,o,o.hasZ,o.hasM);break;default:n.neverReached(o)}return i});return{geometryType:t,features:i,spatialReference:a,fields:e.fields?e.fields.map(function(e){return h.fromJSON(e)}):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function d(e,t,r,n){return{uid:a.generateUID(),objectId:n&&e.attributes?e.attributes[n]:null,attributes:e.attributes,geometry:g(e.geometry,t,r),visible:!0}}function g(e,t,r){if(!e)return null;switch(t){case"point":var a=e,n={x:a.x,y:a.y,z:a.z,m:a.m,hasZ:null!=a.z,hasM:null!=a.m,type:"point",spatialReference:r};return n;case"polyline":var s=e,n={paths:s.paths,hasZ:!!s.hasZ,hasM:!!s.hasM,type:"polyline",spatialReference:r};return n;case"polygon":var i=e,n={rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r};return n;case"multipoint":var o=e,n={points:o.points,hasZ:!!o.hasZ,hasM:!!o.hasM,type:"multipoint",spatialReference:r};return n}}function x(e,t,r,a){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:a,type:"point"}}function b(e){return"declaredClass"in e}function v(e){return"declaredClass"in e}function Z(e){return"declaredClass"in e}function M(e,t){if(!e||Z(e))return e;var r=new a({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=s.clone(e.symbol),r.attributes=s.clone(e.attributes),e.geometry&&("mesh"===e.geometry.type?r.geometry=e.geometry:r.read({geometry:k(e.geometry)})),r}function R(e,t){if(!e)return null;var r;if(v(e)){if(null==t)return e.clone();if(v(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=x(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}function A(e){for(var t=32,r=0,a=Object.keys(e.attributes);r<a.length;r++){var n=a[r];t+=n.length;var s=e.attributes[n];switch(typeof s){case"string":t+=s.length;break;default:case"number":t+=8}}return t+12*(e.geometry?"mesh"===e.geometry.type?0:z(e.geometry):0)}function z(e){if(!e)return 0;switch(e.type){case"point":return 1;case"polyline":for(var t=0,r=0,a=e.paths;r<a.length;r++){t+=a[r].length}return t;case"polygon":for(var t=0,s=0,i=e.rings;s<i.length;s++){t+=i[s].length}return t;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var o=e.vertexAttributes&&e.vertexAttributes.position;return o?o.length/3:0;default:n.neverReached(e)}}function N(e){if(!e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(var t=0,r=e.paths;t<r.length;t++){if(r[t].length>0)return!0}return!1;case"polygon":for(var a=0,s=e.rings;a<s.length;a++){if(s[a].length>0)return!0}return!1;case"multipoint":return e.points.length>0;case"mesh":return e.vertexAttributes&&e.vertexAttributes.position&&e.vertexAttributes.position.length>0;default:n.neverReached(e)}}function k(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var r=e.rings,a=e.hasZ,s=e.hasM;return{rings:F(r),hasZ:a,hasM:s,spatialReference:t};case"polyline":var i=e.paths,a=e.hasZ,s=e.hasM;return{paths:F(i),hasZ:a,hasM:s,spatialReference:t};case"extent":var o=e.xmin,l=e.xmax,u=e.ymin,p=e.ymax,h=e.zmin,c=e.zmax,y=e.mmin,m=e.mmax,a=e.hasZ,s=e.hasM;return{xmin:o,xmax:l,ymin:u,ymax:p,zmin:h,zmax:c,mmin:y,mmax:m,hasZ:a,hasM:s,spatialReference:t};case"multipoint":var f=e.points,a=e.hasZ,s=e.hasM;return{points:B(f)?P(f):f,hasZ:a,hasM:s,spatialReference:t};default:n.neverReached(e)}}function F(e){return w(e)?e.map(function(e){return P(e)}):e}function P(e){return e.map(function(e){return i.toArray(e)})}function w(e){for(var t=0,r=e;t<r.length;t++){var a=r[t];if(0!==a.length)return B(a)}return!1}function B(e){return e.length&&(i.isFloat32Array(e[0])||i.isFloat64Array(e[0]))}function S(e,t){switch(l.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)l.expandWithNestedArray(t,e.paths[r],e.hasZ);break;case"polygon":for(var r=0;r<e.rings.length;r++)l.expandWithNestedArray(t,e.rings[r],e.hasZ);break;case"multipoint":l.expandWithNestedArray(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax);break;default:n.neverReached(e)}}function G(e,t){S(e,j),l.expand(t,j)}function O(e,t){switch(u.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)u.expandWithNestedArray(t,e.paths[r]);break;case"polygon":for(var r=0;r<e.rings.length;r++)u.expandWithNestedArray(t,e.rings[r]);break;case"multipoint":u.expandWithNestedArray(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax;break;default:n.neverReached(e)}}function I(e,t){O(e,J),u.expand(t,J)}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=c.equals,t.isFeatureGeometry=y,t.isPoint=m,t.fromFeatureSetJSON=f,t.fromJSONGeometry=g,t.makeDehydratedPoint=x,t.isHydratedGeometry=b,t.isHydratedPoint=v,t.isHydratedGraphic=Z,t.hydrateGraphic=M,t.clonePoint=R,t.estimateSize=A,t.numVertices=z,t.hasVertices=N,t.computeAABB=S,t.expandAABB=G,t.computeAABR=O,t.expandAABR=I;var j=l.create(),J=u.create()});