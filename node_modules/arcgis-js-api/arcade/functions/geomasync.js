// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","exports","../../kernel","../kernel","../languageUtils","../featureset/support/shared","./centroid","../../geometry/Extent","../../geometry/Geometry","../../geometry/geometryEngineAsync","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/jsonUtils"],function(n,e,t,r,o,i,a,u,l,s,c,f,d,g,m){function y(n){return 0===t.version.indexOf("4.")?d.fromExtent(n):new d({spatialReference:n.spatialReference,rings:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]})}function h(n){if(o.pcCheck(n,2,2),n[0]instanceof l&&n[1]instanceof l);else if(n[0]instanceof l&&null===n[1]);else if(n[1]instanceof l&&null===n[0]);else if(null!==n[0]||null!==n[1])throw new Error("Illegal Argument")}function A(n){"async"===n.mode&&(n.functions.disjoint=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null===t[0]||null===t[1]||s.disjoint(t[0],t[1])})},n.functions.intersects=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null!==t[0]&&null!==t[1]&&s.intersects(t[0],t[1])})},n.functions.touches=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null!==t[0]&&null!==t[1]&&s.touches(t[0],t[1])})},n.functions.crosses=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null!==t[0]&&null!==t[1]&&s.crosses(t[0],t[1])})},n.functions.within=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null!==t[0]&&null!==t[1]&&s.within(t[0],t[1])})},n.functions.contains=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null!==t[0]&&null!==t[1]&&s.contains(t[0],t[1])})},n.functions.overlaps=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null!==t[0]&&null!==t[1]&&s.overlaps(t[0],t[1])})},n.functions.equals=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return o.pcCheck(t,2,2),t[0]===t[1]||(t[0]instanceof l&&t[1]instanceof l?s.equals(t[0],t[1]):!(!o.isDate(t[0])||!o.isDate(t[1]))&&t[0].getTime()===t[1].getTime())})},n.functions.relate=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,3,3),t[0]instanceof l&&t[1]instanceof l)return s.relate(t[0],t[1],o.toString(t[2]));if(t[0]instanceof l&&null===t[1])return!1;if(t[1]instanceof l&&null===t[0])return!1;if(null===t[0]&&null===t[1])return!1;throw new Error("Illegal Argument")})},n.functions.intersection=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null===t[0]||null===t[1]?null:s.intersect(t[0],t[1])})},n.functions.union=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,r){r=o.autoCastFeatureToGeometry(r);var a=[];if(0===r.length)throw new Error("Function called with wrong number of Parameters");if(1===r.length)if(o.isArray(r[0])){for(var u=o.autoCastFeatureToGeometry(r[0]),c=0;c<u.length;c++)if(null!==u[c]){if(!(u[c]instanceof l))throw new Error("Illegal Argument");a.push(u[c])}}else{if(!o.isImmutableArray(r[0])){if(r[0]instanceof l)return o.fixSpatialReference(i.cloneGeometry(r[0]),e.spatialReference);if(null===r[0])return null;throw new Error("Illegal Argument")}for(var f=o.autoCastFeatureToGeometry(r[0].toArray()),c=0;c<f.length;c++)if(null!==f[c]){if(!(f[c]instanceof l))throw new Error("Illegal Argument");a.push(f[c])}}else for(var c=0;c<r.length;c++)if(null!==r[c]){if(!(r[c]instanceof l))throw new Error("Illegal Argument");a.push(r[c])}return 0===a.length?null:s.union(a)})},n.functions.difference=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null!==t[0]&&null===t[1]?i.cloneGeometry(t[0]):null===t[0]?null:s.difference(t[0],t[1])})},n.functions.symmetricdifference=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){return t=o.autoCastFeatureToGeometry(t),h(t),null===t[0]&&null===t[1]?null:null===t[0]?i.cloneGeometry(t[1]):null===t[1]?i.cloneGeometry(t[0]):s.symmetricDifference(t[0],t[1])})},n.functions.clip=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,2),!(t[1]instanceof u)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return null;if(!(t[0]instanceof l))throw new Error("Illegal Argument");return null===t[1]?null:s.clip(t[0],t[1])})},n.functions.cut=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,2),!(t[1]instanceof g)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return[];if(!(t[0]instanceof l))throw new Error("Illegal Argument");return null===t[1]?[i.cloneGeometry(t[0])]:s.cut(t[0],t[1])})},n.functions.area=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,i){if(o.pcCheck(i,1,2),i=o.autoCastFeatureToGeometry(i),null===i[0])return 0;if(o.isFeatureSet(i[0]))return i[0].sumArea(r.convertSquareUnitsToCode(o.defaultUndefined(i[1],-1)),!1,e.progressTracker).then(function(n){if(e.progressTracker.isCanceled())throw new Error("Operation has been cancelled.");return n});if(o.isArray(i[0])||o.isImmutableArray(i[0])){var a=o.autoCastArrayOfPointsToPolygon(i[0],e.spatialReference);return null===a?0:s.planarArea(a,r.convertSquareUnitsToCode(o.defaultUndefined(i[1],-1)))}if(!(i[0]instanceof l))throw new Error("Illegal Argument");return s.planarArea(i[0],r.convertSquareUnitsToCode(o.defaultUndefined(i[1],-1)))})},n.functions.areageodetic=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,i){if(o.pcCheck(i,1,2),i=o.autoCastFeatureToGeometry(i),null===i[0])return 0;if(o.isFeatureSet(i[0]))return i[0].sumArea(r.convertSquareUnitsToCode(o.defaultUndefined(i[1],-1)),!0,e.progressTracker).then(function(n){if(e.progressTracker.isCanceled())throw new Error("Operation has been cancelled.");return n});if(o.isArray(i[0])||o.isImmutableArray(i[0])){var a=o.autoCastArrayOfPointsToPolygon(i[0],e.spatialReference);return null===a?0:s.geodesicArea(a,r.convertSquareUnitsToCode(o.defaultUndefined(i[1],-1)))}if(!(i[0]instanceof l))throw new Error("Illegal Argument");return s.geodesicArea(i[0],r.convertSquareUnitsToCode(o.defaultUndefined(i[1],-1)))})},n.functions.length=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,i){if(o.pcCheck(i,1,2),i=o.autoCastFeatureToGeometry(i),null===i[0])return 0;if(o.isFeatureSet(i[0]))return i[0].sumLength(r.convertLinearUnitsToCode(o.defaultUndefined(i[1],-1)),!1,e.progressTracker).then(function(n){if(e.progressTracker.isCanceled())throw new Error("Operation has been cancelled.");return n});if(o.isArray(i[0])||o.isImmutableArray(i[0])){var a=o.autoCastArrayOfPointsToPolyline(i[0],e.spatialReference);return null===a?0:s.planarLength(a,r.convertLinearUnitsToCode(o.defaultUndefined(i[1],-1)))}if(!(i[0]instanceof l))throw new Error("Illegal Argument");return s.planarLength(i[0],r.convertLinearUnitsToCode(o.defaultUndefined(i[1],-1)))})},n.functions.lengthgeodetic=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,i){if(o.pcCheck(i,1,2),i=o.autoCastFeatureToGeometry(i),null===i[0])return 0;if(o.isFeatureSet(i[0]))return i[0].sumLength(r.convertLinearUnitsToCode(o.defaultUndefined(i[1],-1)),!0,e.progressTracker).then(function(n){if(e.progressTracker.isCanceled())throw new Error("Operation has been cancelled.");return n});if(o.isArray(i[0])||o.isImmutableArray(i[0])){var a=o.autoCastArrayOfPointsToPolyline(i[0],e.spatialReference);return null===a?0:s.geodesicLength(a,r.convertLinearUnitsToCode(o.defaultUndefined(i[1],-1)))}if(!(i[0]instanceof l))throw new Error("Illegal Argument");return s.geodesicLength(i[0],r.convertLinearUnitsToCode(o.defaultUndefined(i[1],-1)))})},n.functions.distance=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,i){i=o.autoCastFeatureToGeometry(i),o.pcCheck(i,2,3);var a=i[0];(o.isArray(i[0])||o.isImmutableArray(i[0]))&&(a=o.autoCastArrayOfPointsToMultiPoint(i[0],e.spatialReference));var u=i[1];if((o.isArray(i[1])||o.isImmutableArray(i[1]))&&(u=o.autoCastArrayOfPointsToMultiPoint(i[1],e.spatialReference)),!(a instanceof l))throw new Error("Illegal Argument");if(!(u instanceof l))throw new Error("Illegal Argument");return s.distance(a,u,r.convertLinearUnitsToCode(o.defaultUndefined(i[2],-1)))})},n.functions.densify=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof l))throw new Error("Illegal Argument");var i=o.toNumber(t[1]);if(isNaN(i))throw new Error("Illegal Argument");if(i<=0)throw new Error("Illegal Argument");return t[0]instanceof d||t[0]instanceof g?s.densify(t[0],i,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]instanceof u?s.densify(y(t[0]),i,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]})},n.functions.densifygeodetic=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof l))throw new Error("Illegal Argument");var i=o.toNumber(t[1]);if(isNaN(i))throw new Error("Illegal Argument");if(i<=0)throw new Error("Illegal Argument");return t[0]instanceof d||t[0]instanceof g?s.geodesicDensify(t[0],i,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]instanceof u?s.geodesicDensify(y(t[0]),i,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]})},n.functions.generalize=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,4),null===t[0])return null;if(!(t[0]instanceof l))throw new Error("Illegal Argument");var i=o.toNumber(t[1]);if(isNaN(i))throw new Error("Illegal Argument");return s.generalize(t[0],i,o.toBoolean(o.defaultUndefined(t[2],!0)),r.convertLinearUnitsToCode(o.defaultUndefined(t[3],-1)))})},n.functions.buffer=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof l))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");return 0===a?i.cloneGeometry(t[0]):s.buffer(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)))})},n.functions.buffergeodetic=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof l))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");return 0===a?i.cloneGeometry(t[0]):s.geodesicBuffer(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)))})},n.functions.offset=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,6),null===t[0])return null;if(!(t[0]instanceof d||t[0]instanceof g))throw new Error("Illegal Argument");var i=o.toNumber(t[1]);if(isNaN(i))throw new Error("Illegal Argument");var a=o.toNumber(o.defaultUndefined(t[4],10));if(isNaN(a))throw new Error("Illegal Argument");var u=o.toNumber(o.defaultUndefined(t[5],0));if(isNaN(u))throw new Error("Illegal Argument");return s.offset(t[0],i,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)),o.toString(o.defaultUndefined(t[3],"round")).toLowerCase(),a,u)})},n.functions.rotate=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3);var r=t[0];if(null===r)return null;if(!(r instanceof l))throw new Error("Illegal Argument");r instanceof u&&(r=d.fromExtent(r));var i=o.toNumber(t[1]);if(isNaN(i))throw new Error("Illegal Argument");var a=o.defaultUndefined(t[2],null);if(null===a)return s.rotate(r,i);if(a instanceof f)return s.rotate(r,i,a);throw new Error("Illegal Argument")})},n.functions.centroid=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,r){if(r=o.autoCastFeatureToGeometry(r),o.pcCheck(r,1,1),null===r[0])return null;var s=r[0];if((o.isArray(r[0])||o.isImmutableArray(r[0]))&&(s=o.autoCastArrayOfPointsToMultiPoint(r[0],e.spatialReference)),null===s)return null;if(!(s instanceof l))throw new Error("Illegal Argument");return s instanceof f?o.fixSpatialReference(i.cloneGeometry(r[0]),e.spatialReference):s instanceof d?s.centroid:s instanceof g?a.centroidPolyline(s):s instanceof c?a.centroidMultiPoint(s):s instanceof u?s.center:null})},n.functions.multiparttosinglepart=function(e,t){return n.standardFunctionAsync(e,t,function(n,t,r){r=o.autoCastFeatureToGeometry(r),o.pcCheck(r,1,1);var a=[];if(null===r[0])return null;if(!(r[0]instanceof l))throw new Error("Illegal Argument");return r[0]instanceof f?[o.fixSpatialReference(i.cloneGeometry(r[0]),e.spatialReference)]:r[0]instanceof u?[o.fixSpatialReference(i.cloneGeometry(r[0]),e.spatialReference)]:s.simplify(r[0]).then(function(n){if(n instanceof d){for(var t=[],u=[],l=0;l<n.rings.length;l++)if(n.isClockwise(n.rings[l])){var s=m.fromJSON({rings:[n.rings[l]],hasZ:!0===n.hasZ,hazM:!0===n.hasM,spatialReference:n.spatialReference.toJSON()});t.push(s)}else u.push({ring:n.rings[l],pt:n.getPoint(l,0)});for(var f=0;f<u.length;f++)for(var y=0;y<t.length;y++)if(t[y].contains(u[f].pt)){t[y].addRing(u[f].ring);break}return t}if(n instanceof g){for(var h=[],l=0;l<n.paths.length;l++){var A=m.fromJSON({paths:[n.paths[l]],hasZ:!0===n.hasZ,hazM:!0===n.hasM,spatialReference:n.spatialReference.toJSON()});h.push(A)}return h}if(r[0]instanceof c){for(var w=o.fixSpatialReference(i.cloneGeometry(r[0]),e.spatialReference),l=0;l<w.points.length;l++)a.push(w.getPoint(l));return a}return null})})},n.functions.issimple=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,1,1),null===t[0])return!0;if(!(t[0]instanceof l))throw new Error("Illegal Argument");return s.isSimple(t[0])})},n.functions.simplify=function(e,t){return n.standardFunctionAsync(e,t,function(n,e,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,1,1),null===t[0])return null;if(!(t[0]instanceof l))throw new Error("Illegal Argument");return s.simplify(t[0])})})}Object.defineProperty(e,"__esModule",{value:!0}),e.registerFunctions=A});