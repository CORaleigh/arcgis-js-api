// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/assignHelper","../../../Color","./size","./support/colors","./support/utils"],function(e,o,a,n,r,i,t){function c(e,o){return e.map(function(e){var a=new n(e);return null!=o&&(a.a=o),a})}function m(e,o,a,r,t){var m,p=i[e],s=c(p[t]||p.stops),l=new n(o.noDataColor),d=o.fillOpacity||1;if(p)switch(a){case"point":var h=r,v=o;m={colors:s,noDataColor:l,opacity:d,sizeScheme:h,outline:{color:new n(v.outline.color),width:v.outline.width},size:v.size};break;case"polyline":m={colors:s,noDataColor:l,opacity:d,sizeScheme:r,width:o.width};break;case"polygon":var u=r,y=o;u&&u.marker&&null!=y.markerSize&&(u.marker.size=y.markerSize),m={colors:s,noDataColor:l,opacity:d,sizeScheme:u,outline:{color:new n(y.outline.color),width:y.outline.width}};break;case"mesh":m={colors:s,noDataColor:l,opacity:d}}return m}function p(e,o,a){var n=h[o],r=t.getStorageType(a),i=n&&n[r];return i&&i[e]}var s={light:{color:[153,153,153,.25],width:"1px"},dark:{color:[153,153,153,.25],width:"1px"},darker:{color:[26,26,26,.25],width:"1px"}},l={light:["streets","gray","topo","terrain","national-geographic","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},d={default:{name:"default",label:"Default",description:"Default theme for visualizing features by their predominant category.",basemapGroups:l,pointSchemes:{light:{common:{noDataColor:"#aaaaaa",outline:s.light,size:"8px"},primary:"predominant-v1",secondary:["predominant-v2","predominant-v3","predominant-v4","predominant-v5","predominance-race","predominance-money","predominance-race-ethnic","predominance-rainbow","predominance-sequence"]},dark:{common:{noDataColor:"#aaaaaa",outline:s.darker,size:"8px"},primary:"predominant-v2",secondary:["predominant-v1","predominant-v3","predominant-v4","predominant-v5","predominance-race","predominance-money","predominance-race-ethnic","predominance-rainbow","predominance-sequence"]}},polylineSchemes:{light:{common:{noDataColor:"#aaaaaa",width:"2px"},primary:"predominant-v1",secondary:["predominant-v2","predominant-v3","predominant-v4","predominant-v5","predominance-race","predominance-money","predominance-race-ethnic","predominance-rainbow","predominance-sequence"]},dark:{common:{noDataColor:"#aaaaaa",width:"2px"},primary:"predominant-v2",secondary:["predominant-v1","predominant-v3","predominant-v4","predominant-v5","predominance-race","predominance-money","predominance-race-ethnic","predominance-rainbow","predominance-sequence"]}},polygonSchemes:{light:{common:{noDataColor:"#aaaaaa",outline:s.light,fillOpacity:.8,markerSize:"8px"},primary:"predominant-v1",secondary:["predominant-v2","predominant-v3","predominant-v4","predominant-v5","predominance-race","predominance-money","predominance-race-ethnic","predominance-rainbow","predominance-sequence"]},dark:{common:{noDataColor:"#aaaaaa",outline:s.dark,fillOpacity:.8,markerSize:"8px"},primary:"predominant-v2",secondary:["predominant-v1","predominant-v3","predominant-v4","predominant-v5","predominance-race","predominance-money","predominance-race-ethnic","predominance-rainbow","predominance-sequence"]}}}},h={};!function(){for(var e in d){var o=d[e],a=o.basemapGroups,n=h[e]={basemaps:[].concat(a.light).concat(a.dark),point:{},polyline:{},polygon:{}};for(var r in a)for(var i=a[r],t=0;t<i.length;t++){var c=i[t];o.pointSchemes&&(n.point[c]=o.pointSchemes[r]),o.polylineSchemes&&(n.polyline[c]=o.polylineSchemes[r]),o.polygonSchemes&&(n.polygon[c]=o.polygonSchemes[r])}}}();var v={getThemes:function(e){var o=[];for(var a in d){var n=d[a],r=h[a],i=t.getBasemapId(e,r.basemaps);i&&-1===r.basemaps.indexOf(i)||o.push({name:n.name,label:n.label,description:n.description,basemaps:r.basemaps.slice(0)})}return o},getSchemes:function(e){var o=e.basemap,a=e.theme,n=e.geometryType,i=e.numColors,c=e.worldScale,s=e.view,l=a||"default",d="mesh"!==n&&c,u=t.getBasemapId(o,h[l].basemaps),y=p(u,l,n),w=r.getSchemes({basemap:o,geometryType:n,worldScale:c,view:s}),S=w&&w.primaryScheme;if(y){var g=m(y.primary,y.common,n,S,i);return{primaryScheme:d?v.toWorldScale({scheme:g,view:s}):g,secondarySchemes:y.secondary.map(function(e){var o=m(e,y.common,n,S,i);return d?v.toWorldScale({scheme:o,view:s}):o}),basemapId:u}}},cloneScheme:function(e){var o;return e&&(o=a({},e),o.colors=c(o.colors),o.noDataColor&&(o.noDataColor=new n(o.noDataColor)),o.outline&&(o.outline={color:o.outline.color&&new n(o.outline.color),width:o.outline.width}),o.sizeScheme&&(o.sizeScheme=r.cloneScheme(o.sizeScheme))),o},toWorldScale:function(e){if(e.scheme&&e.view){var o=e.scheme,a=e.scheme,n=e.scheme;if(o.hasOwnProperty("size"))return o.size&&(o.size=t.toWorldScale(o.size,e.view)),o;if(a.hasOwnProperty("width"))return a.width&&(a.width=t.toWorldScale(a.width,e.view)),a;if(n.sizeScheme&&n.sizeScheme.hasOwnProperty("marker"))return n.sizeScheme.marker.size&&(n.sizeScheme.marker.size=t.toWorldScale(n.sizeScheme.marker.size,e.view)),a}return e.scheme}};return v});