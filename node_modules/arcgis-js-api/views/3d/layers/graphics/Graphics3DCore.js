// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","exports","../../../../core/tsSupport/declareExtendsHelper","../../../../core/tsSupport/decorateHelper","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../../../geometry","../../../../renderers","../../../../symbols","../../../../core/Accessor","../../../../core/arrayUtils","../../../../core/compilerUtils","../../../../core/Error","../../../../core/Handles","../../../../core/iteratorUtils","../../../../core/Logger","../../../../core/mathUtils","../../../../core/maybe","../../../../core/now","../../../../core/ObjectPool","../../../../core/PooledArray","../../../../core/promiseUtils","../../../../core/watchUtils","../../../../core/accessorSupport/decorators","../../../../core/libs/gl-matrix-2/vec3f64","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/aaBoundingRect","../../../../layers/Layer","../../../../layers/graphics/dehydratedFeatures","../../../../renderers/support/diffUtils","../../../../renderers/support/rendererConversion","../../../../support/arcadeUtils","../../../../symbols/support/symbolConversion","./ElevationQuery","./featureExpressionInfoUtils","./Graphics3DGraphic","./Graphics3DSymbolCreationContext","./Graphics3DSymbolFactory","./Graphics3DWebStyleSymbol","./graphicUtils","./symbolComplexity","../../support/projectionUtils","../../support/PropertiesPool","../../webgl-engine/Stage","../../webgl-engine/lib/GridLocalOriginFactory","../../webgl-engine/lib/Layer"],function(e,t,i,r,a,n,s,o,l,h,p,d,c,y,u,m,g,b,f,v,S,w,C,x,G,D,U,P,R,O,E,_,V,I,F,L,M,A,z,j,B,W,T,H,q,k){var N=new s.Point,Q=G.vec3f64.create(),Y=D.create(),J=m.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),K=function(e){function t(t){var i=e.call(this)||this;return i.propertiesPool=new T.PropertiesPool({computedExtent:s.Extent},i),i.computedExtent=null,i.currentRenderer=null,i.rendererHasGeometryOperations=!1,i.symbolCreationContext=new M.Graphics3DSymbolCreationContext,i.graphics=new Map,i.stageLayer=null,i.stage=null,i.graphicsDrapedUids=new Set,i.graphicsBySymbol=new Map,i.symbolConversionCache=new Map,i.symbols=new Map,i.graphicsWithoutSymbol={},i.graphicsWaitingForSymbol=new Set,i.lastFastUpdate=null,i.handles=new y,i.viewSR=null,i.elevationAlignment=null,i.scaleVisibility=null,i.filterVisibility=null,i.spatialIndex=null,i.deconfliction=null,i.labeling=null,i.highlights=null,i.viewElevationProvider=null,i.sharedSymbolResourcesOwnerHandle=null,i.whenGraphics3DGraphicRequests={},i.pendingUpdates=new Map,i.pendingAdds=0,i.pendingRemoves=0,i.pendingUpdatesPool=new S({allocator:function(e){return e||{add:null,remove:null}},deallocator:function(e){return e.add=null,e.remove=null,e}}),i.symbolWarningLogged=!1,i.geometryWarningLogged=!1,i.objectIdInvisibleSet=new Set,i._whenSymbolRemoved=new S,i.asyncUpdates=!1,i.elevationFeatureExpressionEnabled=!0,i.owner=null,i.layer=null,i.hasDraped=!1,i.graphicSymbolSupported=!0,i._usedMemory=0,i.numberOfGraphics=0,i._visible=void 0,i._startCreateGraphics=!1,i.maxPendingUpdates=0,i}i(t,e),h=t,Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsWaitingForSymbol.size>0||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayFeatureLimit",{get:function(){var e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,i=e?e.graphics3D.maxTotalNumberOfFeatures:0,r=e?e.graphics3D.maxTotalNumberOfPrimitives:0,a=this.maxSymbolComplexity,n=Math.max(t,Math.min(i,Math.ceil(r/Math.max(1,a?a.primitivesPerFeature:1)))),s=this._get("displayFeatureLimit");return s&&s.minimumTotalNumberOfFeatures===t&&s.maximumTotalNumberOfFeatures===i&&s.maximumTotalNumberOfPrimitives===r&&s.maximumSymbolComplexity===a&&s.maximumNumberOfFeatures===n?s:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:i,maximumTotalNumberOfPrimitives:r,maximumSymbolComplexity:a,maximumNumberOfFeatures:n}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSymbolComplexity",{get:function(){for(var e=null,t=this.getSymbolComplexities(),i=0,r=t;i<r.length;i++){var a=r[i];e?0===e.primitivesPerCoordinate&&a.primitivesPerFeature>e.primitivesPerFeature?e=a:0!==e.primitivesPerCoordinate&&a.primitivesPerCoordinate>e.primitivesPerCoordinate&&(e=a):e=a}var n=this._get("maxSymbolComplexity");return!e||n&&n.primitivesPerFeature===e.primitivesPerFeature&&n.primitivesPerCoordinate===e.primitivesPerCoordinate?n:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemory",{get:function(){return this._usedMemory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0}),t.prototype.getSymbolComplexities=function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},t.prototype.getConvertedSymbol=function(e){if("web-style"===e.type)return e.clone();var t=this.symbolConversionCache.get(e.id);if(void 0!==t)return t;var i=V.to3D(e,!0,!1,this.hasLabelingContext(e)),r=i.symbol||null;return r||i.error&&J.error(i.error.message),this.symbolConversionCache.set(e.id,r),r},t.prototype.getSymbolComplexitiesUsedOrRenderer=function(e){var t=e.getSymbols();if(!t||!t.length)return[];for(var i=[],r=0,a=t;r<a.length;r++){var n=a[r],s=this.symbols.get(n.id);if(s)i.push(s.complexity);else{var o=this.getConvertedSymbol(n);o&&i.push(B.defaultSymbolComplexity(o))}}return i},t.prototype.getSymbolComplexitiesUsed=function(){var e=[];return this.symbols.forEach(function(t){t&&e.push(t.complexity)}),e},t.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference},t.prototype.setup=function(e){var t=this;this._set("elevationAlignment",e.elevationAlignment),this._set("scaleVisibility",e.scaleVisibility),this._set("filterVisibility",e.filterVisibility),this._set("spatialIndex",e.spatialIndex),this._set("deconfliction",e.deconfliction),this._set("labeling",e.labeling),this._set("highlights",e.highlights);var i=this.owner.view;this.viewElevationProvider=new I.ViewElevationProvider(this.viewSR,i),this.initializeStage(i,this.layer.uid),this.symbolCreationContext.sharedResources=i.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=i.sharedSymbolResources.addGraphicsOwner(this.owner),this.symbolCreationContext.renderer=this.currentRenderer,this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataSupplier=i.sharedSymbolResources.streamDataSupplier,this.symbolCreationContext.renderSpatialReference=i.renderSpatialReference,this.symbolCreationContext.renderCoordsHelper=i.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.layerOrder=0,this.symbolCreationContext.localOriginFactory=new q,this.symbolCreationContext.elevationProvider=i.elevationProvider,this.symbolCreationContext.isAsync=this.asyncUpdates;var r=F.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=F.createContext(r,this.viewSR,J),this.symbolCreationContext.screenSizePerspectiveEnabled=i.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.handles.add(this.owner.watch("suspended",function(){return t.updateLayerVisibility()}));var a="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this.handles.add([this.owner.watch(a,function(){var e=i.screenSizePerspectiveEnabled&&t.layer.screenSizePerspectiveEnabled;e!==t.symbolCreationContext.screenSizePerspectiveEnabled&&(t.symbolCreationContext.screenSizePerspectiveEnabled=e,t.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",function(e){return t.slicePlaneEnabledChange(!!e)}),this.owner.view.watch("pixelRatio",function(e){return t.pixelRatioChange(e)}),C.when(i.basemapTerrain,"tilingScheme",function(e){e.spatialReference.equals(t.symbolCreationContext.overlaySR)||(t.symbolCreationContext.overlaySR=i.basemapTerrain.spatialReference),t.handles.has("loaded-graphics")?t.recreateAllGraphics():t.handles.add(C.on(t.owner,"loadedGraphics","change",function(e){return t.graphicsCollectionChanged(e)},function(){return t.recreateAllGraphics()}),"loaded-graphics")}),i.resourceController.scheduler.registerTask(3,function(e){return t.update(e)},function(){return t.needsUpdate()})]),this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return t.deconfliction.featureReductionChange()})),this.rendererChange(this.layer.renderer),this.notifyChange("maxSymbolComplexity")},t.prototype.destroy=function(){this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this.clear(),this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(H.ModelContentType.LAYER,this.stageLayer.id),this.stageLayer=null,this.stage=null),this.handles.destroy(),this.handles=null,this.viewSR=null,this._set("owner",null);for(var e in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new c("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null),this.pendingUpdatesPool=null,this.symbolConversionCache.clear(),this.objectIdInvisibleSet.clear()},t.prototype.clear=function(){this.graphics.forEach(function(e){return e.destroy()}),this.spatialIndex&&this.spatialIndex.clear(),this.graphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this.updateLayerVisibility(),this.symbols.forEach(function(e){e&&e.destroy()}),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol={},this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this.pendingAdds=0,this.pendingRemoves=0,this._set("hasDraped",!1),this.notifyChange("updating"),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.initializeStage=function(e,t){this.stage=e._stage,this.stageLayer=new k(t,{isPickable:!this.owner.suspended},t),this.stage.add(H.ModelContentType.LAYER,this.stageLayer),this.stage.addToViewContent([this.stageLayer.id])},t.prototype.setDrawingOrder=function(e){this.symbolCreationContext.layerOrder=e;var t=new Set;this.symbols.forEach(function(i){i&&i.setDrawOrder(e,t)}),t.size>0&&this.stage.getDrapedRenderer().updateRenderOrder(t)},t.prototype.updateLayerVisibility=function(){var e=!!this.owner.suspended,t=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*ee,i=!e&&!t;i!==this._visible&&(this._visible=i,i?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())},t.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0}),t.prototype.getGraphics3DGraphicById=function(e){return this.graphics.get(e)},t.prototype._getGraphicObjectID=function(e,t){return void 0===t&&(t=this.owner.layer&&this.owner.layer.objectIdField),null!=e.objectId?e.objectId:t&&e.attributes[t]},Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){var e=this,t=this.owner.layer&&this.owner.layer.objectIdField;if(!t)return null;var i=new Map;return this.graphics.forEach(function(r){if(r){var a=r.graphic,n=e._getGraphicObjectID(a,t);b.isSome(n)&&i.set(n,r)}}),i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0}),t.prototype.updateLabelingInfo=function(e){var t=this.deconfliction&&this.deconfliction.labelingInfoChange(e),i=this.labeling&&this.labeling.labelingInfoChange(e);return w.all([t,i]).then()},t.prototype.updateVisibilityInfo=function(){this.deconfliction&&this.deconfliction.labelingInfoChange(),this.labeling&&this.labeling.visibilityInfoChange()},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){var e=this;if(this.pendingUpdates.size>0)return"unknown";var t=0,i=0;return u.everyMap(this.symbols,function(r,a){if(r){var n=r.getFastUpdateStatus();if(n.loading>0)return!1;e.graphicsBySymbol.has(a)&&(i+=n.fast,t+=n.slow)}})?i>=0&&0===t?"fast":t>=0&&0===i?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0}),t.prototype.needsUpdate=function(){return this.pendingUpdates.size>0||!!this.lastFastUpdate&&f()-this.lastFastUpdate>500},t.prototype.update=function(e){var t=this.needsUpdate();this._applyPendingUpdates(e),!e.done&&this.lastFastUpdate&&(this.lastFastUpdate=null),t!==this.needsUpdate()&&this.notifyChange("updating")},t.prototype.setObjectIdVisibility=function(e,t){t?this.objectIdInvisibleSet.delete(e):this.objectIdInvisibleSet.add(e);var i=this._findGraphics3DGraphicByObjectId(e);b.isSome(i)&&this._updateUserVisibility(i)},t.prototype._findGraphics3DGraphicByObjectId=function(e){var t,i=this;return u.everyMap(this.graphics,function(r){return i._getGraphicObjectID(r.graphic)!==e||(t=r,!1)}),t},t.prototype._updateUserVisibility=function(e){if(b.isNone(e))return!1;var t=e.graphic,i=this._getGraphicObjectID(t),r=t.visible&&!this.owner.suspended&&(b.isNone(i)||!this.objectIdInvisibleSet.has(i));return e.setVisibilityFlag(0,r,0)},t.prototype.whenGraphics3DGraphic=function(e){var t=this.graphics.get(e.uid);if(t)return w.resolve(t);var i=this.whenGraphics3DGraphicRequests[e.uid];if(i)return i.promise;var r=w.createDeferred();return this.whenGraphics3DGraphicRequests[e.uid]=r,r.promise},t.prototype.boundsForGraphics3DGraphic=function(e,t){return n(this,void 0,void 0,function(){var i,r,n,s,o,l,h,p,d,c;return a(this,function(a){switch(a.label){case 0:return i=this.owner.view.spatialReference,r=this.owner.view.renderSpatialReference,n=this.owner.view.basemapTerrain.spatialReference,s=function(e,t,a){return W.bufferToBuffer(e,r,t,e,i,t,a)},o=function(e,t,r){return W.bufferToBuffer(e,n,t,e,i,t,r)},l=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:t&&t.useViewElevation,minDemResolution:t&&t.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,e.getProjectedBoundingBox(s,o,l)];case 1:return(h=a.sent())?(p=h.boundingBox,h.requiresDrapedElevation&&(d=this.symbolCreationContext.elevationProvider)&&(D.center(p,Q),N.x=Q[0],N.y=Q[1],N.z=void 0,N.spatialReference=i,c=d.getElevation(N)||0,p[2]=Math.min(p[2],c),p[5]=Math.max(p[5],c)),[2,{boundingBox:p,screenSpaceObjects:h.screenSpaceObjects}]):[2,null]}})})},t.prototype.whenGraphicBounds=function(e,t){var i=this;return C.whenOnce(this.owner,"loadedGraphics").then(function(){var t=i.owner.layer&&i.owner.layer.objectIdField,r=i.owner.loadedGraphics.find(function(i){return i===e||t&&i.attributes&&e.attributes&&i.attributes[t]===e.attributes[t]});if(r)return i.whenGraphics3DGraphic(r);throw new c("internal:graphic-not-part-of-view","Graphic is not part of this view")}).then(function(e){return i.boundsForGraphics3DGraphic(e,t)})},t.prototype.whenSymbolLayerSize=function(e,t){return n(this,void 0,void 0,function(){var i,r,n;return a(this,function(a){if(null==(i=this.symbols.get(e.id)))throw new c("internal:symbol-not-part-of-view","Symbol is not part of this view");if(-1===(r=e.symbolLayers.indexOf(t)))throw new c("internal:missing-symbol-layer","Symbol layer is not in symbol");return n=w.createResolver(),i.getSymbolLayerSize(r,function(e){null==e?n.reject(new c("internal:missing-size","Symbol layer has no valid size")):n(e)}),[2,n.promise]})})},t.prototype.graphicsCollectionChanged=function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))},t.prototype.graphicUpdateHandler=function(e){var t=e.graphic.uid,i=this.graphics.get(t),r=this.graphicsWithoutSymbol[t];if(i||r)switch(e.property){case"visible":this.graphicUpdateVisibleHandler(i,e);break;case"geometry":this.graphicUpdateGeometryHandler(i,e);break;case"symbol":this.graphicUpdateSymbolHandler(i,e);break;case"attributes":break;default:d.neverReached(e)}},t.prototype.graphicUpdateGeometryHandler=function(e,t){var i=t.graphic.geometry;if(!i)return void this.recreateGraphic(t.graphic);if(b.isNone(e)){var r=t.graphic.symbol&&t.graphic.symbol.id;if(r){var a=this.symbols.get(r);if(a&&!a.isFulfilled())return}return void this.recreateGraphic(t.graphic)}e.graphics3DSymbol.updateGeometry(e,t.newValue)||this.recreateGraphic(e.graphic),this.expandComputedExtent(i)},t.prototype.graphicUpdateSymbolHandler=function(e,t){var i=t.graphic,r=b.isSome(e)?e.graphics3DSymbol:t.oldValue&&this.symbols.get(t.oldValue.id);if(!r)return void this.recreateGraphic(i);var a=r.symbol,n=this.getConvertedSymbol(t.newValue);if(n.type!==a.type||"web-style"===n.type||"web-style"===a.type)return void this.recreateGraphic(i);var s=this.graphicsBySymbol.get(a.id);if(s&&1!==s.size)return void this.recreateGraphic(i);var o=O.diff(a,n);if(b.isNone(o))return void this.updateSymbolMapping(a.id,n);var l={diff:o,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(r.prepareSymbolPatch(l),!O.isEmpty(l.diff))return void this.recreateGraphic(i);for(var h=0,p=l.symbolStatePatches;h<p.length;h++){var d=p[h];d()}var c=this._getRenderingInfo(i);if(b.isSome(e))for(var y=0,u=l.graphics3DGraphicPatches;y<u.length;y++){var d=u[y];d(e,c)}this.updateSymbolMapping(a.id,n)},t.prototype.graphicUpdateVisibleHandler=function(e,t){var i=this._updateUserVisibility(e);i&&this.labeling&&(this.lastFastUpdate=f(),this.owner.view.labeler.setDirty()),i&&this.owner.view.deconflictor.setDirty()},t.prototype.recreateGraphic=function(e){var t=[e];this.remove(t),this.add(t)},t.prototype._beginGraphicUpdate=function(e){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"),this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)},t.prototype._endGraphicUpdate=function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))},t.prototype.expandComputedExtent=function(e){var t=Y,i=e.spatialReference;R.computeAABB(e,t);var r=this.viewSR,a=h.tmpVec;if(i.equals(r)||W.xyzToVector(t[0],t[1],0,i,a,r)&&(t[0]=a[0],t[1]=a[1],W.xyzToVector(t[3],t[4],0,i,a,r),t[3]=a[0],t[4]=a[1]),g.isFinite(t[0])&&g.isFinite(t[3])&&g.isFinite(t[1])&&g.isFinite(t[4])){var n=this.computedExtent,s=null,o=g.isFinite(t[2])&&g.isFinite(t[5]),l=o&&(!n||null==n.zmin||t[2]<n.zmin),p=o&&(!n||null==n.zmax||t[5]>n.zmax);if(n){(t[0]<n.xmin||t[1]<n.ymin||t[3]>n.xmax||t[4]>n.ymax||l||p)&&(s=this.propertiesPool.get("computedExtent"),s.xmin=Math.min(t[0],n.xmin),s.ymin=Math.min(t[1],n.ymin),s.xmax=Math.max(t[3],n.xmax),s.ymax=Math.max(t[4],n.ymax),s.spatialReference=r)}else s=this.propertiesPool.get("computedExtent"),s.xmin=t[0],s.ymin=t[1],s.xmax=t[3],s.ymax=t[4],s.spatialReference=r;s&&(l&&(s.zmin=t[2]),p&&(s.zmax=t[5]),this._set("computedExtent",s))}},t.prototype.updateHasDraped=function(){var e=this.graphicsDrapedUids.size>0;this._set("hasDraped",e)},t.prototype.elevationInfoChange=function(){var e=this,t=F.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=F.createContext(t,this.viewSR,J),this.labeling&&this.labeling.elevationInfoChange(),this.forEachGraphics3DSymbol(function(t,i,r){t.globalPropertyChanged("elevationInfo",i)?i.forEach(function(e){for(var t=e.graphic,i=e._labelGraphics,r=0;r<i.length;r++){var a=i[r];a.graphics3DSymbolLayer.updateGraphicElevationContext(t,a)}}):e._recreateSymbol(r)}),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()},t.prototype.clearSymbolsAndGraphics=function(){this.clear(),this.filterVisibility&&this.filterVisibility.clear(),this.labeling&&this.labeling.reset(),this.deconfliction&&this.deconfliction.clear(),this.elevationAlignment&&this.elevationAlignment.clear(),this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()},t.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0,this.recreateAllGraphics()},t.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))},t.prototype._recreateSymbol=function(e){var t=this,i=this.graphicsBySymbol.get(e),r=[];i.forEach(function(e,i){var a=e.usedMemory;t._conditionalRemove(e,i),t.spatialIndex&&t.spatialIndex.remove(e),r.push(e.graphic),e.destroy(),t.removeGraphics3DGraphic(i,a),t.updateLayerVisibility()}),this.graphicsBySymbol.set(e,new Map);var a=this.symbols.get(e);a&&a.destroy(),this.symbols.delete(e),this.updateHasDraped(),this.add(r)},t.prototype._conditionalRemove=function(e,t){e.isDraped()&&this.graphicsDrapedUids.delete(t),this.highlights&&this.highlights.removeGraphic(e),this.labeling&&this.labeling.removeGraphic(e),this.deconfliction&&this.deconfliction.removeGraphic(e)},t.prototype.add=function(e){if(e&&0!==e.length){if(!this.owner.view.basemapTerrain||!this.owner.view.basemapTerrain.tilingScheme)return void J.error("#add()","Cannot add graphics before terrain surface has been initialized");this.asyncUpdates?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")}},t.prototype._addImmediate=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,X.clear();for(var i=0,r=e;i<r.length;i++){var a=r[i];this._startAddGraphic(a,X)}X.forEach(function(e){return t._finishAddGraphics(e)}),X.clear(),this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty(),this._cleanupSymbols()},t.prototype._addDelayed=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t],a=r.uid,n=this.pendingUpdates.get(a);if(n)n.add||this.pendingAdds++,n.add=r;else{var s=this.pendingUpdatesPool.pushNew();s.add=r,this.pendingAdds++,this.pendingUpdates.set(a,s)}}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.remove=function(e){this.asyncUpdates?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")},t.prototype._removeImmediate=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this._removeGraphic(r)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype._removeDelayed=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t],a=r.uid,n=this.pendingUpdates.get(a);if(n)n.add&&(n.remove?n.add=null:this.pendingUpdates.delete(a),this.pendingAdds--);else{var s=this.pendingUpdatesPool.pushNew();s.remove=r,this.pendingUpdates.set(a,s),this.pendingRemoves++}}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&J.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0},t.prototype._applyPendingUpdates=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var i=e.idleFrame?1e3:100,r=0;X.clear(),u.everyMap(this.pendingUpdates,function(a,n){if(a.remove&&(t.pendingRemoves--,t._removeGraphic(a.remove)),a.add&&(t.pendingAdds--,t._startAddGraphic(a.add,X)&&r++),t.pendingUpdates.delete(n),r>i&&(X.forEach(function(e){return t._finishAddGraphics(e)}),X.clear(),r=0),e.madeProgress(),e.done)return!1}),X.forEach(function(e){return t._finishAddGraphics(e)}),X.clear(),0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining"),this.updateHasDraped()},t.prototype._startAddGraphic=function(e,t){this.graphicsWithoutSymbol[e.uid]=e;var i=this._getRenderingInfo(e,J);if(!i)return!1;var r=i.symbol,a=this.getOrCreateGraphics3DSymbol(r,i.renderer);if(!a)return!1;this.expandComputedExtent(e.geometry),this._beginGraphicUpdate(e);var n={graphic:e,renderingInfo:i,layer:this.layer},s=a.symbol.id,o=t.get(s);if(o)o.graphics.push(n);else{var l=$.acquire();l.clear(),l.push(n),t.set(s,{asyncSymbol:a,graphics:l})}return!0},t.prototype._finishAddGraphics=function(e){var t=this,i=!1,r=function(t){t===e.asyncSymbol.symbol.id&&(i=!0)};this._whenSymbolRemoved.push(r),e.asyncSymbol.then(function(){t._whenSymbolRemoved.removeUnordered(r),Z.clear();for(var a=0;a<e.graphics.length;a++){var n=e.graphics.data[a],s=n.graphic;if(!(i||e.asyncSymbol.destroyed||t.graphicSymbolSupported&&s.symbol&&s.symbol.id!==e.asyncSymbol.symbol.id)){if(t.graphicsWaitingForSymbol.has(s.uid)){var o=t.createGraphics3DGraphic(e.asyncSymbol,n);t.spatialIndex&&o&&Z.push(o)}t._endGraphicUpdate(s)}--e.asyncSymbol.referenced}Z.length>0&&(t.spatialIndex.addMany(Z.data,Z.length),Z.clear()),e.graphics.clear(),$.release(e.graphics),t.labeling&&(t.lastFastUpdate=f(),t.owner.view.labeler.setDirty())},function(){t._whenSymbolRemoved.removeUnordered(r);if(!i&&!e.asyncSymbol.destroyed)for(var a=0;a<e.graphics.length;a++)t._endGraphicUpdate(e.graphics.data[a].graphic);e.graphics.clear(),$.release(e.graphics)})},t.prototype._removeGraphic=function(e){var t=e.uid,i=this.graphics.get(t);if(i){var r=i.usedMemory;this._conditionalRemove(i,t),this.spatialIndex&&this.spatialIndex.remove(i);var a=i.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(a).delete(t),delete this.graphicsWithoutSymbol[t],this.removeGraphics3DGraphic(t,r),i.destroy()}else delete this.graphicsWithoutSymbol[t],this.graphicsWaitingForSymbol.delete(t)},t.prototype.hasLabelingContext=function(e){if(e instanceof l.LabelSymbol3D||e instanceof l.TextSymbol){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(function(t){return t.symbol===e})}return!1},t.prototype.hasValidSymbolCreationContext=function(e){return!(e instanceof l.LabelSymbol3D&&!this.hasLabelingContext(e))||(J.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1)},t.prototype._getRenderingInfo=function(e,t){if(!e.geometry)return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&e.symbol)return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;var i=this.rendererHasGeometryOperations?R.hydrateGraphic(e,this.layer):e,r=this.owner.getRenderingInfo(i,this.currentRenderer);return r&&r.symbol?r:(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null)},t.prototype.createGraphics3DSymbol=function(e,t){var i=this;if(!this.hasValidSymbolCreationContext(e))return null;var r=this.getConvertedSymbol(e);if(!r)return null;var a;if(t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var n=V.to3D(t.backgroundFillSymbol,!1,!0);n.symbol&&"web-style"!==n.symbol.type&&(a=n.symbol.symbolLayers)}var s=A.make(r,this.symbolCreationContext,a);return s.then(function(){return i.notifyChange("maxSymbolComplexity")}),s},t.prototype.getOrCreateGraphics3DSymbol=function(e,t){var i=this,r=this.symbols.get(e.id);return void 0===r&&(r=e instanceof l.WebStyleSymbol?new z(e,function(e){return i.createGraphics3DSymbol(e,t)}):this.createGraphics3DSymbol(e,t),this.symbols.set(e.id,r)),r&&++r.referenced,r},t.prototype.addGraphics3DGraphic=function(e){this._usedMemory+=e.usedMemory,this.graphics.set(e.graphic.uid,e),this.numberOfGraphics++,this.updateLayerVisibility()},t.prototype.removeGraphics3DGraphic=function(e,t){this._usedMemory-=t,this.graphics.delete(e),this.numberOfGraphics--,this.updateLayerVisibility()},t.prototype.createGraphics3DGraphic=function(e,t){var i=t.graphic;if(delete this.graphicsWithoutSymbol[i.uid],!this.symbols.has(e.symbol.id))return void this.add([i]);if(!this.graphics.has(i.uid)){var r=e.createGraphics3DGraphic(t),a=e.symbol.id;this.addGraphics3DGraphic(r),this.graphicsBySymbol.has(a)||this.graphicsBySymbol.set(a,new Map),this.graphicsBySymbol.get(a).set(i.uid,r),r.initialize(this.stageLayer,this.stage);r.isDraped()&&(this.graphicsDrapedUids.add(i.uid),this._set("hasDraped",!0)),r.centroid=null,"point"!==i.geometry.type&&r instanceof L&&(r.centroid=j.computeCentroid(i.geometry,this.viewSR)),this._updateUserVisibility(r),this.deconfliction&&this.deconfliction.addGraphic(r),this.labeling&&this.labeling.addGraphic(r),this.scaleVisibility&&this.scaleVisibility.updateVisibility(r),this.filterVisibility&&this.filterVisibility.updateVisibility(r),this.highlights&&this.highlights.addGraphic(r),this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,r);var n=this.whenGraphics3DGraphicRequests[i.uid];return n&&(delete this.whenGraphics3DGraphicRequests[i.uid],n.resolve(r)),r}},t.prototype.rendererChange=function(e){var t=this;e!==this.currentRenderer&&(this.validateRenderer(e),_.hasGeometryOperations(e)?_.enableGeometryOperations().then(function(){t.layer.renderer===e&&t.currentRendererChange(e,!0)}):this.currentRendererChange(e,!1))},t.prototype.currentRendererChange=function(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t;var i=this.symbolCreationContext.renderer;if(e!==i){this.symbolConversionCache.clear();var r=O.diff(i,e);this.updateUnchangedSymbolMappings(r,e,i),this.symbolCreationContext.renderer=e,b.isNone(r)||("complete"===r.type?this.recreateAllGraphics():"partial"===r.type&&(this.applyRendererDiff(r,e,i)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}},t.prototype.diffHasSymbolChange=function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1},t.prototype.applySymbolSetDiff=function(e,t,i,r){var a=this;e=e||[],t=t||[];for(var n=[],s=this,o=0,l=t;o<l.length;o++){var h=l[o];!function(t){var r=s.graphicsBySymbol.get(t.id);r&&r.forEach(function(s,o){
var l=s.graphic,h=a.layer instanceof P?a.layer:null;if(t!==i.defaultSymbol||i.getSymbol(R.hydrateGraphic(l,h))!==i.defaultSymbol){var p=s.usedMemory;e.length||i.defaultSymbol?n.push(l):a.graphicsWithoutSymbol[o]=l;var d=a.graphics.get(o);a._conditionalRemove(d,o),s.destroy(),r.delete(o),a.removeGraphics3DGraphic(o,p),a.updateLayerVisibility()}}),s._whenSymbolRemoved.forEach(function(e){return e(t.id)})}(h)}if(e.length||n.length){for(var p in this.graphicsWithoutSymbol)n.push(this.graphicsWithoutSymbol[p]);this.graphicsWithoutSymbol={},this.add(n)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype.applyUniqueValueRendererDiff=function(e,t,i){var r=e.diff.defaultSymbol,a=e.diff.uniqueValueInfos;if(r||a){var n=a?a.added.map(function(e){return e.symbol}):[],s=a?a.removed.map(function(e){return e.symbol}):[];if(a)for(var o=0;o<a.changed.length;o++)n.push(a.changed[o].newValue.symbol),s.push(a.changed[o].oldValue.symbol);return r?(i.defaultSymbol&&s.push(i.defaultSymbol),t.defaultSymbol&&n.push(t.defaultSymbol)):i.defaultSymbol&&n.length&&s.push(t.defaultSymbol),this.applySymbolSetDiff(n,s,t,i),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1},t.prototype.calculateUnchangedSymbolMapping=function(e,t,i){if(t instanceof o.UniqueValueRenderer&&i instanceof o.UniqueValueRenderer&&(b.isNone(e)||"partial"===e.type)){var r=e&&e.diff,a=r&&r.defaultSymbol,n=r&&r.uniqueValueInfos,s=void 0;return s=n?n.unchanged.map(function(e){return{oldId:e.oldValue.symbol.id,newId:e.newValue.symbol.id}}):i.uniqueValueInfos.map(function(e,i){return{oldId:e.symbol.id,newId:t.uniqueValueInfos[i].symbol.id}}),!a&&i.defaultSymbol&&s.push({oldId:i.defaultSymbol.id,newId:t.defaultSymbol.id}),s}return[]},t.prototype.updateSymbolMapping=function(e,t){var i="string"==typeof t?t:t.id,r="string"==typeof t?null:t;if(e&&e!==i){var a=this.graphicsBySymbol.get(e);this.graphicsBySymbol.delete(e),void 0!==a&&this.graphicsBySymbol.set(i,a);var n=this.symbols.get(e);this.symbols.delete(e),void 0!==n&&(this.symbols.set(i,n),r?n.symbol=r:n.symbol.id=i)}},t.prototype.updateUnchangedSymbolMappings=function(e,t,i){for(var r=this.calculateUnchangedSymbolMapping(e,t,i),a=0,n=r;a<n.length;a++){var s=n[a],o=s.oldId,l=s.newId;this.updateSymbolMapping(o,l)}},t.prototype.applyRendererDiff=function(e,t,i){var r=this;return!this.diffHasSymbolChange(e)&&(!!(t instanceof o.UniqueValueRenderer&&i instanceof o.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(e,t,i)&&0===Object.keys(e.diff).length)||u.everyMap(this.graphicsBySymbol,function(i,a){var n=r.symbols.get(a);if(n&&!n.applyRendererDiff(e,t))return!1}))},t.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(e){return e.globalPropertyChanged("opacity")}),this.updateStageLayerVisibility()},t.prototype.slicePlaneEnabledChange=function(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol(function(e,t){return e.globalPropertyChanged("slicePlaneEnabled",t)}),this.deconfliction&&this.deconfliction.slicePlaneEnabledChange(),this.labeling&&this.labeling.slicePlaneEnabledChange())},t.prototype.pixelRatioChange=function(e){var t=this;this.forEachGraphics3DSymbol(function(e,i,r){e.globalPropertyChanged("pixelRatio",i)||t._recreateSymbol(r)})},t.prototype.setClippingExtent=function(e,t){var i=this.symbolCreationContext.clippingExtent,r=U.create();return W.extentToBoundingRect(e,r,t)?this.symbolCreationContext.clippingExtent=[r[0],r[1],-1/0,r[2],r[3],1/0]:this.symbolCreationContext.clippingExtent=null,!p.equals(this.symbolCreationContext.clippingExtent,i)},t.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()},t.prototype.forEachGraphics3DGraphic=function(e){var t=this;if(this.owner.loadedGraphics){var i=!1;this.owner.loadedGraphics.forEach(function(r){var a=t.getGraphics3DGraphicById(r.uid);a&&e(a,r)&&(i=!0)}),i&&this.notifyVisibilityChanged()}},t.prototype.forEachGraphics3DSymbol=function(e){var t=this;this.graphicsBySymbol.forEach(function(i,r){var a=t.symbols.get(r);a&&e(a,i,r)})},t.prototype.updateAllGraphicsVisibility=function(){var e=this;this.filterVisibility&&(this.filterVisibility.dirty=!0),this.forEachGraphics3DGraphic(function(t){var i=e._updateUserVisibility(t),r=e.scaleVisibility&&e.scaleVisibility.updateVisibility(t);return i||r})},t.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(e){return e.setVisibilityFlag(0,!1,0)})},t.prototype.validateRenderer=function(e){var t=E.validateTo3D(e);if(t){var i="Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView";J.warn(i,t.message)}},t.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=f(),this.labeling.reset()),this.stageLayer.invalidateSpatialQueryAccelerator(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")},t.prototype._cleanupSymbols=function(){var e=this;if(!(this.graphicsWaitingForSymbol.size>0)){var t=!1;this.symbols.forEach(function(i,r){if(i&&!(i.referenced>0)){var a=e.graphicsBySymbol.get(r);a&&0!==a.size||(e.graphicsBySymbol.delete(r),e.symbols.delete(r),i&&i.destroy(),t=!0)}}),t&&this.notifyChange("maxSymbolComplexity")}},t.prototype.snapshotInternals=function(){var e=this;return{graphics:p.keysOfMap(this.graphics).sort(),symbols:p.keysOfMap(this.symbols).sort(),graphicsBySymbol:p.keysOfMap(this.graphicsBySymbol).sort().map(function(t){return{symbolId:t,graphics:p.keysOfMap(e.graphicsBySymbol.get(t)).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:p.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}},Object.defineProperty(t.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility}},enumerable:!0,configurable:!0}),t.prototype.getStats=function(){return{coreVisible:this.graphics.size,coreMissing:Object.keys(this.graphicsWithoutSymbol).length,corePending:this.pendingUpdates.size}};var h;return t.tmpVec=G.vec3f64.create(),r([x.property({readOnly:!0})],t.prototype,"computedExtent",void 0),r([x.property()],t.prototype,"currentRenderer",void 0),r([x.property()],t.prototype,"rendererHasGeometryOperations",void 0),r([x.property({readOnly:!0})],t.prototype,"elevationAlignment",void 0),r([x.property({readOnly:!0})],t.prototype,"scaleVisibility",void 0),r([x.property({readOnly:!0})],t.prototype,"filterVisibility",void 0),r([x.property({readOnly:!0})],t.prototype,"spatialIndex",void 0),r([x.property({readOnly:!0})],t.prototype,"deconfliction",void 0),r([x.property({readOnly:!0})],t.prototype,"labeling",void 0),r([x.property({readOnly:!0})],t.prototype,"highlights",void 0),r([x.property()],t.prototype,"asyncUpdates",void 0),r([x.property({constructOnly:!0})],t.prototype,"elevationFeatureExpressionEnabled",void 0),r([x.property({constructOnly:!0})],t.prototype,"owner",void 0),r([x.property({constructOnly:!0})],t.prototype,"layer",void 0),r([x.property({readOnly:!0})],t.prototype,"hasDraped",void 0),r([x.property({readOnly:!0})],t.prototype,"symbolsUpdating",void 0),r([x.property({constructOnly:!0})],t.prototype,"graphicSymbolSupported",void 0),r([x.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating","filterVisibility.updating"]})],t.prototype,"updating",null),r([x.property({readOnly:!0})],t.prototype,"updatingRemaining",null),r([x.property({readOnly:!0})],t.prototype,"updatingTotal",null),r([x.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],t.prototype,"displayFeatureLimit",null),r([x.property({readOnly:!0})],t.prototype,"maxSymbolComplexity",null),t=h=r([x.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],t)}(x.declared(h)),X=new Map,Z=new S,$=new v(S),ee=(function(){function e(){this.add=null,this.remove=null}}(),10);return K});