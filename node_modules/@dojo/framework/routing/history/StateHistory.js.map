{"version":3,"file":"StateHistory.js","sourceRoot":"","sources":["StateHistory.ts"],"names":[],"mappings":"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","sourcesContent":["import global from '../../shim/global';\nimport { History as HistoryInterface, HistoryOptions, OnChangeFunction } from './../interfaces';\nimport has from '../../has/has';\n\nconst trailingSlash = new RegExp(/\\/$/);\nconst leadingSlash = new RegExp(/^\\//);\n\nfunction stripBase(base: string, path: string): string {\n\tif (base === '/') {\n\t\treturn path;\n\t}\n\n\tif (path.indexOf(base) === 0) {\n\t\treturn path.slice(base.length - 1);\n\t}\n\treturn '/';\n}\n\nexport class StateHistory implements HistoryInterface {\n\tprivate _current: string;\n\tprivate _onChangeFunction: OnChangeFunction;\n\tprivate _window: Window;\n\tprivate _base: string;\n\n\tconstructor({ onChange, window = global.window, base }: HistoryOptions) {\n\t\tif (!base) {\n\t\t\tbase = has('public-path') ? `${has('public-path')}` : '/';\n\t\t}\n\t\tif (/(#|\\?)/.test(base)) {\n\t\t\tthrow new TypeError(\"base must not contain '#' or '?'\");\n\t\t}\n\t\tthis._onChangeFunction = onChange;\n\t\tthis._window = window;\n\t\tthis._base = base;\n\t\tif (!trailingSlash.test(this._base)) {\n\t\t\tthis._base = `${this._base}/`;\n\t\t}\n\t\tif (!leadingSlash.test(this._base)) {\n\t\t\tthis._base = `/${this._base}`;\n\t\t}\n\t\tthis._window.addEventListener('popstate', this._onChange, false);\n\t\tthis._onChange();\n\t}\n\n\tpublic prefix(path: string) {\n\t\tif (path[0] === '#') {\n\t\t\tpath = path.slice(1);\n\t\t}\n\t\tif (path[0] === '/') {\n\t\t\tpath = path.slice(1);\n\t\t}\n\t\treturn `${this._base}${path}`;\n\t}\n\n\tpublic set(path: string) {\n\t\tthis._window.history.pushState({}, '', this.prefix(stripBase(this._base, path)));\n\t\tthis._onChange();\n\t}\n\n\tpublic get current(): string {\n\t\treturn this._current;\n\t}\n\n\tprivate _onChange = () => {\n\t\tconst pathName = this._window.location.pathname.replace(/\\/$/, '');\n\t\tconst value = stripBase(this._base, pathName + this._window.location.search);\n\t\tif (this._current === value) {\n\t\t\treturn;\n\t\t}\n\t\tthis._current = value;\n\t\tthis._onChangeFunction(this._current);\n\t};\n}\n\nexport default StateHistory;\n"]}