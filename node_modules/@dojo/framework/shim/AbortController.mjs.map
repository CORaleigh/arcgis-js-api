{"version":3,"file":"AbortController.mjs","sourceRoot":"","sources":["AbortController.ts"],"names":[],"mappings":"AAAA,OAAO,MAAM,MAAM,UAAU,CAAC;AAC9B,OAAO,GAAG,MAAM,YAAY,CAAC;AAC7B,OAAO,EAAE,SAAS,EAAE,MAAM,SAAS,CAAC;AAYpC,yCAAyC;AACzC,MAAM,CAAC,IAAI,eAAe,GAA2B,MAAM,CAAC,WAAW,CAAC;AAExE,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;IAC1B,MAAM,CAAC,WAAW,GAAG,eAAe,GAAG;QAAA;YAC9B,aAAQ,GAAG,KAAK,CAAC;YAGzB,cAAS,GAAmD,EAAE,CAAC;QA4ChE,CAAC;QA1CA,IAAI,OAAO;YACV,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;QACtB,CAAC;QAED,gBAAgB,CAAC,IAAY,EAAE,QAAgC;YAC9D,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;gBAC/B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;YAC3B,CAAC;YACD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACrC,CAAC;QAED,mBAAmB,CAAC,IAAY,EAAE,QAA8B;YAC/D,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;gBAC/B,MAAM,CAAC;YACR,CAAC;YAED,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,EAAwB,EAAE,EAAE,CAAC,EAAE,KAAK,QAAQ,CAAC,CAAC;YAE7F,EAAE,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC;gBAChB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YACvC,CAAC;QACF,CAAC;QAED,aAAa,CAAC,KAAY;YACzB,MAAM,EAAE,IAAI,EAAE,GAAG,KAAK,CAAC;YACvB,EAAE,CAAC,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC,CAAC;gBACtB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACrB,EAAE,CAAC,CAAC,OAAO,IAAI,CAAC,OAAO,KAAK,UAAU,CAAC,CAAC,CAAC;oBACxC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;gBAChC,CAAC;YACF,CAAC;YAED,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;gBAC/B,MAAM,CAAC,KAAK,CAAC;YACd,CAAC;YAED,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,QAA8B,EAAE,EAAE;gBAC/D,UAAU,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC;YACjD,CAAC,CAAC,CAAC;YAEH,MAAM,CAAC,CAAC,KAAK,CAAC,cAAc,CAAC;QAC9B,CAAC;KACD,CAAC;AACH,CAAC;AAYD,yCAAyC;AACzC,MAAM,CAAC,IAAI,mBAAmB,GAA+B,MAAM,CAAC,eAAe,CAAC;AAEpF,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;IAC9B,MAAM,CAAC,eAAe,GAAG,mBAAmB,GAAG;QAAA;YACrC,WAAM,GAAgB,IAAI,eAAe,EAAE,CAAC;QAqBtD,CAAC;QAnBA,KAAK;YACJ,IAAI,KAAY,CAAC;YACjB,IAAI,CAAC;gBACJ,KAAK,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;YAC5B,CAAC;YAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACZ,EAAE,CAAC,CAAC,OAAO,QAAQ,KAAK,WAAW,CAAC,CAAC,CAAC;oBACrC,KAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;oBACtC,KAAK,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;gBACxC,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACP,KAAK,GAAG;wBACP,IAAI,EAAE,OAAO;wBACb,OAAO,EAAE,KAAK;wBACd,UAAU,EAAE,KAAK;qBACR,CAAC;gBACZ,CAAC;YACF,CAAC;YAED,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAClC,CAAC;KACD,CAAC;AACH,CAAC;AAED,eAAe,mBAAmB,CAAC","sourcesContent":["import global from './global';\nimport has from '../has/has';\nimport { findIndex } from './array';\n\nexport interface AbortSignal extends EventTarget {\n\taborted: boolean;\n\tonabort: undefined | ((ev: Event) => any);\n}\n\nexport interface AbortSignalConstructor {\n\treadonly prototype: AbortSignal;\n\tnew (): AbortSignal;\n}\n\n// tslint:disable-next-line variable-name\nexport let ShimAbortSignal: AbortSignalConstructor = global.AbortSignal;\n\nif (!has('abort-signal')) {\n\tglobal.AbortSignal = ShimAbortSignal = class implements AbortSignal {\n\t\tprivate _aborted = false;\n\t\tonabort: undefined | ((ev: Event) => any);\n\n\t\tlisteners: { [type: string]: ((event: Event) => void)[] } = {};\n\n\t\tget aborted(): boolean {\n\t\t\treturn this._aborted;\n\t\t}\n\n\t\taddEventListener(type: string, callback: (event: Event) => void): void {\n\t\t\tif (!(type in this.listeners)) {\n\t\t\t\tthis.listeners[type] = [];\n\t\t\t}\n\t\t\tthis.listeners[type].push(callback);\n\t\t}\n\n\t\tremoveEventListener(type: string, callback: (event: any) => void): void {\n\t\t\tif (!(type in this.listeners)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst index = findIndex(this.listeners[type], (cb: (event: any) => void) => cb === callback);\n\n\t\t\tif (index >= 0) {\n\t\t\t\tthis.listeners[type].splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\tdispatchEvent(event: Event): boolean {\n\t\t\tconst { type } = event;\n\t\t\tif (type === 'abort') {\n\t\t\t\tthis._aborted = true;\n\t\t\t\tif (typeof this.onabort === 'function') {\n\t\t\t\t\tthis.onabort.call(this, event);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!(type in this.listeners)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.listeners[type].forEach((callback: (event: any) => void) => {\n\t\t\t\tsetTimeout(() => callback.call(this, event), 0);\n\t\t\t});\n\n\t\t\treturn !event.preventDefault;\n\t\t}\n\t};\n}\n\nexport interface AbortController {\n\treadonly signal: AbortSignal;\n\tabort(): void;\n}\n\nexport interface AbortControllerConstructor {\n\treadonly prototype: AbortController;\n\tnew (): AbortController;\n}\n\n// tslint:disable-next-line variable-name\nexport let ShimAbortController: AbortControllerConstructor = global.AbortController;\n\nif (!has('abort-controller')) {\n\tglobal.AbortController = ShimAbortController = class implements AbortController {\n\t\treadonly signal: AbortSignal = new ShimAbortSignal();\n\n\t\tabort(): void {\n\t\t\tlet event: Event;\n\t\t\ttry {\n\t\t\t\tevent = new Event('abort');\n\t\t\t} catch (e) {\n\t\t\t\tif (typeof document !== 'undefined') {\n\t\t\t\t\tevent = document.createEvent('Event');\n\t\t\t\t\tevent.initEvent('abort', false, false);\n\t\t\t\t} else {\n\t\t\t\t\tevent = {\n\t\t\t\t\t\ttype: 'abort',\n\t\t\t\t\t\tbubbles: false,\n\t\t\t\t\t\tcancelable: false\n\t\t\t\t\t} as Event;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.signal.dispatchEvent(event);\n\t\t}\n\t};\n}\n\nexport default ShimAbortController;\n"]}