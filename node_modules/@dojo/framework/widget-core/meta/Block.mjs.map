{"version":3,"file":"Block.mjs","sourceRoot":"","sources":["Block.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,wBAAwB,CAAC;AACrD,OAAO,GAAG,MAAM,gBAAgB,CAAC;AACjC,OAAO,OAAO,MAAM,oBAAoB,CAAC;AAGzC,MAAM,YAAa,SAAQ,WAAW;IAIrC,YAAY,UAAgC;QAC3C,KAAK,EAAE,CAAC;QAJD,eAAU,GAAG,IAAI,OAAO,EAAiB,CAAC;QAKjD,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC,UAAU,CAAC;IAC1C,CAAC;IAEM,GAAG,CAAqB,MAAS;QACvC,MAAM,eAAe,GAAQ,CAAC,GAAG,IAAW,EAAE,EAAE;YAC/C,IAAI,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAC3C,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACf,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAC;gBACrB,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;YACvC,CAAC;YACD,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YACxC,MAAM,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YACvC,EAAE,CAAC,CAAC,KAAK,KAAK,SAAS,CAAC,CAAC,CAAC;gBACzB,MAAM,CAAC,KAAK,CAAC;YACd,CAAC;YAED,QAAQ,CAAC,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;YAC/B,MAAM,MAAM,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC,CAAC;YAC/B,EAAE,CAAC,CAAC,OAAO,MAAM,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC;gBACvC,MAAM,CAAC,IAAI,CAAC,CAAC,MAAW,EAAE,EAAE;oBAC3B,QAAQ,CAAC,GAAG,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;oBACjC,IAAI,CAAC,WAAW,EAAE,CAAC;gBACpB,CAAC,CAAC,CAAC;gBACH,MAAM,CAAC,IAAI,CAAC;YACb,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,QAAQ,CAAC,GAAG,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;YAClC,CAAC;YACD,MAAM,CAAC,MAAM,CAAC;QACf,CAAC,CAAC;QACF,MAAM,CAAC,eAAoB,CAAC;IAC7B,CAAC;CACD;AAED,eAAe,KAAK,CAAC","sourcesContent":["import { Destroyable } from '../../core/Destroyable';\nimport Map from '../../shim/Map';\nimport WeakMap from '../../shim/WeakMap';\nimport { WidgetMetaProperties, MetaBase } from '../interfaces';\n\nexport class Block extends Destroyable implements MetaBase {\n\tprivate _moduleMap = new WeakMap<Function, any>();\n\tprivate _invalidate: () => void;\n\n\tconstructor(properties: WidgetMetaProperties) {\n\t\tsuper();\n\t\tthis._invalidate = properties.invalidate;\n\t}\n\n\tpublic run<T extends Function>(module: T): T {\n\t\tconst decoratedModule: any = (...args: any[]) => {\n\t\t\tlet valueMap = this._moduleMap.get(module);\n\t\t\tif (!valueMap) {\n\t\t\t\tvalueMap = new Map();\n\t\t\t\tthis._moduleMap.set(module, valueMap);\n\t\t\t}\n\t\t\tconst argsString = JSON.stringify(args);\n\t\t\tconst value = valueMap.get(argsString);\n\t\t\tif (value !== undefined) {\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tvalueMap.set(argsString, null);\n\t\t\tconst result = module(...args);\n\t\t\tif (typeof result.then === 'function') {\n\t\t\t\tresult.then((result: any) => {\n\t\t\t\t\tvalueMap.set(argsString, result);\n\t\t\t\t\tthis._invalidate();\n\t\t\t\t});\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\tvalueMap.set(argsString, result);\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t\treturn decoratedModule as T;\n\t}\n}\n\nexport default Block;\n"]}