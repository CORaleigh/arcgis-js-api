// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","exports","../../FunctionWrapper","../../languageUtils","../../../geometry/Geometry"],function(e,r,n,t,a){function o(e,r){for(var n="{",t=0;t<r.properties.length;t++){var a=r.properties[t];n+=("Identifier"===a.key.type?JSON.stringify(a.key.name):M(e,a.key))+":"+M(e,a.value)}return n+="}"}function s(e,r){for(var n="{\n",t=0;t<r.body.length;t++)n+=M(e,r.body[t])+" \n";return n+="}\n"}function u(e,r){return null===r.argument?"return;":"return "+M(e,r.argument)+";\n"}function l(e,r){var n="function "+N(r.id.name,e.globalMangles,{}),t=[],a={};a={};for(var o={},s=0,u=r.params;s<u.length;s++){var l=u[s],i=D(l.name,o);t.push(i),a[l.name]=1}return n+="("+t.join(",")+") ",n+=M({functions:e.functions,globals:e.globals,symbols:e.symbols,context:e.context,globalMangles:e.globalMangles,localMangles:o,locals:a},r.body)}function i(e,r){for(var n=[],t=0;t<r.declarations.length;t++)n.push(M(e,r.declarations[t]));return"var "+n.join(",")+"; "}function c(e,r){var n=null===r.init?null:M(e,r.init),t=D(r.name,e.mangles);return""===n?t:t+" = "+n}function p(e,r){throw new Error("Not Supported")}function f(e,r){return"true"===r.computed?M(e,r.object)+"["+M(e,r.property)+"]":M(e,r.object)+"."+r.property.name}function m(e,r){return"for( "+M(e,r.left)+" in "+M(e,r.right)+") "+M(e,r.body)+"\n"}function g(e,r){var n="for(";return null!==r.init&&(n+=M(e,r.init)),n+=";",null!==r.test?n+=M(e,r.test):n+=" ;",null!==r.update?n+=M(e,r.update):n+=" ;",n+=") ",n+=M(e,r.body)+"\n"}function v(e,r){return!0===r.prefix?r.operator+M(e,r.argument):M(e,r.argument)+r.operator}function y(e,r){return"if "+M(e,r.test)+" "+M(e,r.consequent)+(null!==r.alternate?"else "+M(e,r.alternate):"")}function b(e,r){return M(e,r.expression)+";"}function d(e,r){return"("+M(e,r.left)+" "+r.operator+" "+M(e,r.right)+")"}function h(e,r){return!0===r.prefix?r.operator+M(e,r.argument):M(e,r.argument)+r.operator}function E(e,r){for(var n=[],t=0;t<r.elements.length;t++)n.push(M(e,r.elements[t]));return"["+n.join(",")+"]"}function x(e,r){return M(e,r.left)+" "+r.operator+" "+M(e,r.right)}function S(e,r){return M(e,r.left)+" "+r.operator+" "+M(e,r.right)}function w(e,r){for(var n=M(e,r.callee)+"(",t=[],a=0,o=r.arguments;a<o.length;a++){var s=o[a];t.push(M(e,s))}return n+=t.join(",")+")"}function M(e,r){switch(r.type){case"EmptyStatement":return"";case"VariableDeclarator":return c(e,r);case"VariableDeclaration":return i(e,r);case"BlockStatement":return s(e,r);case"FunctionDeclaration":return l(e,r);case"ReturnStatement":return u(e,r);case"IfStatement":return y(e,r);case"ExpressionStatement":return b(e,r);case"AssignmentExpression":return S(e,r);case"UpdateExpression":return v(e,r);case"BreakStatement":return"break;";case"ContinueStatement":return"continue;";case"ForStatement":return g(e,r);case"ForInStatement":return m(e,r);case"Identifier":return O(e,r);case"MemberExpression":return f(e,r);case"Literal":return null===r.value||void 0===r.value?"null":JSON.stringify(r.value);case"ThisExpression":throw new Error("NOTSUPPORTED");case"CallExpression":return w(e,r);case"UnaryExpression":return h(e,r);case"BinaryExpression":return d(e,r);case"LogicalExpression":return x(e,r);case"ConditionalExpression":throw new Error("NOTSUPPORTED");case"ArrayExpression":return E(e,r);case"ObjectExpression":return o(e,r);case"Property":return p(e,r);case"Array":throw new Error("NOTSUPPORTED");default:throw new Error("UNREOGNISED")}}function O(e,r){var o=r.name.toLowerCase();if(void 0!==e.locals[o])return N(r.name,e.globalMangles,e.localMangles);var s=e.context.globalScope[o];if(void 0===s)return r.name;if(null!==s){if(s.value instanceof n){var u=T(s.value,e.functions,e.globals,e.symbols);return u}if(null==s){var u=k(e.symbols);return e.globals.push({name:u,type:"null",params:{value:null}}),u}if(s instanceof a){var u=k(e.symbols);return e.globals.push({name:u,type:"geometry",params:{value:s}}),u}if(t.isNumber(s)){var u=k(e.symbols);return e.globals.push({name:u,type:"number",params:{value:s}}),u}if(t.isDate(s)){var u=k(e.symbols);return e.globals.push({name:u,type:"date",params:{value:t.toDate(s).getTime()}}),u}if(t.isString(s)){var u=k(e.symbols);return e.globals.push({name:u,type:"string",params:{value:s}}),u}if(t.isFeatureSet(s));else if(t.isImmutableArray(s));else if(!t.isArray(s))throw new Error("Unsupported Type")}return r.name}function k(e){for(var r=!1,n="";!1===r;)n="$gi_"+j.toString(),j++,void 0===e.syms[n]&&(r=!0);return n}function D(e,r){var n="$$fc_"+j.toString();return j++,r[e]=n,n}function N(e,r,n){return void 0===n[e]?void 0===r[e]?e:r[e]:n[e]}function T(e,r,n,t){var a={functions:r,globals:n,symbols:t,context:e.context,locals:{},globalMangles:{},localMangles:{}},o=e.definition.id.name;if(void 0!==r.lkp[o])return r.lkp[o].mangledname;var s=D(o,a.globalMangles),u={name:o,mangledname:s,script:""};return u.script=M(a,e.definition),r.lkp[u.name]=u,r.stack.push(u),s}Object.defineProperty(r,"__esModule",{value:!0});var j=0;r.exportFunctionAsArcade=T});