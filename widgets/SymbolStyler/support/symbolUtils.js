// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/assignHelper","dojo/dom-construct","dojo/i18n!../nls/SymbolStyler","dojo/on","../../../core/promiseUtils","../../../core/screenUtils","../../../symbols/support/Symbol3DOutline","../../../symbols/support/symbolLayerUtils"],function(e,t,i,n,r,o,u,l,c,s){function f(e,t){e[t]||(e[t]={})}function a(e,t){return e.indexOf(t)>-1}function d(e){return j(e)}function h(e){return e&&"icon"===e.type}function p(e){return e&&"object"===e.type}function m(e){return e&&"line"===e.type}function y(e){return e&&"path"===e.type}function b(e){return e&&"extrude"===e.type}function g(e){return e&&"fill"===e.type}function v(e){return e&&"text"===e.type}function w(e){return M(e,"simple-line","2d")}function x(e){return M(e,"simple-marker","2d")}function z(e){return M(e,"simple-fill","2d")}function S(e){return M(e,"picture-marker","2d")}function O(e){return M(e,"fill","2d")}function j(e){return a(e.type,"3d")}function k(e){return e.symbolLayers.getItemAt(0)}function L(e,t){return M(e,"marker",t)||M(e,"point",t)}function P(e){return d(e)&&b(k(e))}function C(e){return d(e)&&v(k(e))}function M(e,t,i){var n=e&&e.type,r=a(n,t);return i?r&&("3d"===i?j(e):!j(e)):r}function F(e,t){return M(e,"line",t)}function U(e,t){return M(e,"fill",t)}function D(e){return e&&"string"==typeof e.style}function N(e){return!d(e)&&(D(e)&&a(De,e.style))}function T(e){return d(e)?A(e):I(e)}function A(e){var t=k(e);return g(t)&&t.outline||h(t)&&we(t)?{color:t.outline.color,size:l.pt2px(t.outline.size)}:m(t)||y(t)?{color:t.material&&t.material.color,size:l.pt2px(t.size)}:null}function I(e){return w(e)?{color:e.color,size:e.width}:O(e)||x(e)?{color:e.get("outline.color"),size:e.get("outline.width")}:null}function q(e,t){!isNaN(t)&&e&&(d(e)?R(e,t):_(e,t))}function R(e,t){var i=k(e);h(i)||g(i)?(f(i,"outline"),i.outline.size=l.px2pt(t)):m(i)?(f(i,"size"),i.size=l.px2pt(t)):y(i)&&(f(i,"size"),i.size=t)}function _(e,t){w(e)?e.width=t:fe(e)&&(e.outline.width=t)}function B(e,t){t&&e&&!j(e)&&(t=T(e).color?t:"none",w(e)?e.style=t:fe(e)&&(e.outline.style=t))}function E(e,t){e&&!isNaN(t)&&(d(e)?H(e,t):W(e,t))}function H(e,t){var i=k(e);h(i)||v(i)?i.size=l.px2pt(t):p(i)?V(i,t):b(i)&&(i.size=t)}function V(e,t){var i=e.width,n=e.height,r=e.depth,o=Math.max(i,n,r),u=t/o;e.set({width:i*u,height:n*u,depth:r*u})}function W(e,t){var i=e.width,n=t;if(i!==n)if(S(e)){var r=e.url,o=$({dimensions:e,targetDimension:"width",targetSize:n});if(e.height=o.height,e.width=o.width,!r||"http://"===r||!a(r,"http://")&&!a(r,"data:"))return;if(e.xoffset||e.yoffset){var u=e.width/i;e.xoffset=Math.round(e.xoffset*u),e.yoffset=Math.round(e.yoffset*u)}}else e.size=n}function G(e){if(!d(e))return x(e)?e.size:S(e)?J(e):void 0;var t=k(e);return h(t)||v(t)?l.pt2px(t.size):p(t)?J(t):b(t)?t.size:void 0}function J(e){return Math.max(e.width,e.height,e.depth)}function K(e,t){d(e)?he(e,{color:t}):e.color=t}function Q(e){return d(e)?X(e):Y(e)}function X(e){return k(e).get("material.color")}function Y(e){return e.color}function Z(e,t){if(d(e)){var i=k(e);return m(i)||y(i)?void he(e,{color:t}):(f(i,"outline"),void(i.outline.color=t))}T(e).color=t}function $(e){var t=e.dimensions,i="height"===e.targetDimension?"height":"width",n=e.targetSize;return"height"===i?{height:n,width:t.width/t.height*n}:{height:t.height/t.width*n,width:n}}function ee(e){var t,i,r,l=u.create(function(u,l){r=n.create("img"),t=o(r,"load",function(){if(0===r.width&&0===r.height)return void l("image has both width and height of 0");u({width:r.width,height:r.height})}),i=o(r,"error",function(e){l("error ocurred while loading image")}),r.src=e});return l.catch(function(){}).then(function(){t.remove(),i.remove(),n.destroy(r)}),l}function te(e){d(e.symbol)?ie(e):ne(e)}function ie(e){E(e.symbol,e.size)}function ne(e){E(e.symbol,e.size)}function re(e){d(e.symbol)?oe(e):ue(e)}function oe(e){K(e.symbol,e.color)}function ue(e){K(e.symbol,e.color)}function le(e){d(e.symbol)?ce(e):se(e)}function ce(e){Z(e.symbol,e.color),q(e.symbol,e.size)}function se(e){Z(e.symbol,e.color),B(e.symbol,e.pattern),q(e.symbol,e.size)}function fe(e){return e&&e.outline}function ae(e){if(d(e))return!1;var t=void 0;return t=fe(e)?e.outline.color:e.color,de(t)}function de(e){return e&&e.r>246&&e.g>246&&e.b>246}function he(e,t){var n=k(e);if(t.color)return void(n.material=i({},n.material,t));n.material=void 0}function pe(e){z(e)&&"solid"!==e.style&&"none"!==e.style&&(e.style="solid")}function me(e,t){return void 0===t&&(t=[]),d(e)?ge(e,t):be(e,t)}function ye(e){return a(["circle","square","diamond","triangle"],e.style)}function be(e,t){var i=e.type,n=["simple-marker","picture-marker"],r=["simple-marker","simple-fill"],o=["simple-marker","simple-line","simple-fill"],u=F(e),l=U(e);return{shape:{state:a(t,"shape")||u||l?"excluded":a(n,i)?"enabled":"disabled"},fill:{state:a(t,"fill")||u?"excluded":r[0]===i&&ye(e)||r[1]===i?"enabled":"disabled"},outline:{state:a(t,"outline")?"excluded":a(o,i)?"enabled":"disabled"}}}function ge(e,t){var i=k(e),n=i.type,r=["icon","object"],o=["icon","object","fill","extrude","text"],u=["icon","fill","line","path"];return{shape:{state:a(t,"shape")||!a(r,n)?"excluded":"enabled"},fill:{state:a(t,"fill")||!a(o,n)?"excluded":ve(i)?"disabled":"enabled"},outline:{state:a(t,"outline")||!a(u,n)?"excluded":!h(i)||we(i)||ve(i)?"enabled":"disabled"}}}function ve(e){return h(e)&&a(De,e.get("resource.primitive"))}function we(e){return!!h(e)&&(e.outline&&!e.get("resource.href"))}function xe(e){if(d(e)){var t=k(e).type;if("extrude"===t||"object"===t)return"meters"}return"pixels"}function ze(e){if(d(e)){if("path"===k(e).type)return"meters"}return"pixels"}function Se(e){if(d(e)){if(L(e)){var t=k(e);return p(t)?"web-style:volumetric":h(t)?"web-style:flat":"web-style"}return"web-style"}return"symbol-set"}function Oe(e){var t=k(e).type;return"object"===t||"path"===t||"extrude"===t?"volumetric":"flat"}function je(e){if(d(e)){var t=k(e);if(h(t)&&(t.outline||(t.outline=new c.Symbol3DOutline({color:void 0,size:0})),void 0===t.size))return s.computeLayerSize(t).then(function(i){return t.size=i[0],e});if(p(t)&&void 0===t.width&&void 0===t.height&&void 0===t.depth)return s.computeLayerSize(t).then(function(i){return t.set({width:i[0],height:i[1],depth:i[2]}),e})}return u.resolve(e)}function ke(e,t){if(d(e)&&d(t)){var i=k(e),n=k(t);return h(i)&&p(n)&&!!i.resource.href&&!n.resource.href&&!!n.resource.primitive}return S(e)&&x(t)}function Le(e,t){if(d(e)&&d(t)){var i=k(e),n=k(t);return h(i)&&h(n)&&!i.resource.href&&!n.resource.href&&!a(De,i.resource.primitive)&&a(De,n.resource.primitive)}return Ce(e,t)}function Pe(e,t){return d(e)&&d(t)?Le(t,e):Ce(t,e)}function Ce(e,t){return x(e)&&x(t)&&!N(e)&&N(t)}function Me(e){if(!d(e))return"";var t=k(e);if(!h(t)&&!p(t))return"";if(e.styleOrigin)return e.styleOrigin.name;if(!Ue(t))return"";var i=t.get("resource.primitive");if(h(t))return r[i];if(p(t)){return{sphere:r.sphere,cylinder:r.cylinder,"tall-cylinder":r.tallCylinder,cube:r.cube,"tall-cube":r.tallCube,cone:r.cone,"tall-cone":r.tallCone,"inverted-cone":r.invertedCone,diamond:r.diamond,tetrahedron:r.tetrahedron}[Fe(t)?"tall-"+i:i]}}function Fe(e){var t=e.depth,i=e.height,n=e.width;return n&&t&&i&&n===t&&n<i}function Ue(e){return!e.get("resource.href")&&!!e.get("resource.primitive")}Object.defineProperty(t,"__esModule",{value:!0});var De=["x","cross"];t.is3d=j,t.getSymbolLayer=k,t.isPoint=L,t.hasExtrudeSymbolLayer=P,t.hasTextSymbolLayer=C,t.isLine=F,t.isPolygon=U,t.hasPureOutlineStyle=N,t.getOutline=T,t.setOutlineWidth=q,t.setOutlineStyle=B,t.setSize=E,t.getMarkerLength=G,t.setFillColor=K,t.getFillColor=Q,t.setOutlineColor=Z,t.preserveAspectRatio=$,t.testImageUrl=ee,t.updateShape=te,t.updateFill=re,t.updateOutline=le,t.blendsIntoBackground=ae,t.updateMaterial=he,t.ensureSupportedSimpleFillSymbolStyle=pe,t.getApplicableTabs=me,t.getSizeUnit=xe,t.getOutlineUnit=ze,t.getSymbolSource=Se,t.getDimensionality=Oe,t.ensureProps=je,t.switchedFromRasterToVectorSymbol=ke,t.switchedToPureOutline=Le,t.switchedFromPureOutline=Pe,t.switchedSmsStyleToPureOutline=Ce,t.getSymbolName=Me});