// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.11/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils"],function(t,e,a,i){function h(t,e){var a=t||{},i=a.format,h=a.quality,r=a.rotation,o=a.disableSlice,n=e.padding||H,l={width:e.width-n.left-n.right,height:e.height-n.top-n.bottom,padding:n},f=m(t,l),u=c(t,f),d=u.width,g=u.height,w=p(i),s=C[w];return{format:w,quality:x(null!=h?h:s,0,100),area:f,width:d,height:g,rotation:r,disableSlice:o||!1}}function r(t,e){var a=h(t,e),i=a.area,r=a.width/i.width,o=e.padding,n=o.left+o.right,l=o.top+o.bottom,f=e.width-n,u=e.height-l,d=Math.floor(f*r+n),g=Math.floor(u*r+l),w=t&&t.layers?t.layers:[];return{framebufferWidth:d,framebufferHeight:g,region:{x:Math.floor(i.x*r)+o.left,y:Math.floor(i.y*r)+o.top,width:a.width,height:a.height},format:a.format,quality:a.quality,rotation:a.rotation,pixelRatio:r,layers:w,disableSlice:a.disableSlice}}function o(t,e,a,i){i.premultipliedAlpha&&y(t),a.width=t.width,a.height=t.height;var h=a.getContext("2d");h.putImageData(t,0,0),i.flipY&&v(h);var r=h.getImageData(0,0,t.width,t.height),o=n(a,e);return a.width=0,a.height=0,{dataUrl:o,data:r}}function n(t,e){var a=q[e.format],i=e.quality/100;return t.toDataURL(a,i)}function l(t,e,a){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(I)try{return new ImageData(t,e)}catch(t){I=!1}return g(t,e,a)}function f(t,e,a,i){if(!e||!a)throw new Error("Cannot construct image data without dimensions");if(I)try{return new ImageData(t,e,a)}catch(t){I=!1}var h=g(e,a,i);return h.data.set(t,0),h}function u(t,e,a,i,h,r,o,n){void 0===i&&(i=0),void 0===h&&(h=0),void 0===r&&(r=t.width-i),void 0===o&&(o=t.height-h),void 0===n&&(n=!1);for(var l=t.data,f=e.width,u=e.height,d=e.data,g=r/f,w=o/u,c=Math.ceil(g/2),m=Math.ceil(w/2),s=t.width,M=0;M<u;M++)for(var p=0;p<f;p++){for(var v=4*(p+(n?u-M-1:M)*f),y=0,x=0,b=0,j=0,S=0,D=0,I=(M+.5)*w,q=Math.floor(M*w);q<(M+1)*w;q++)for(var R=Math.abs(I-(q+.5))/m,C=(p+.5)*g,H=R*R,U=Math.floor(p*g);U<(p+1)*g;U++){var E=Math.abs(C-(U+.5))/c,W=Math.sqrt(H+E*E);if(!(W>=1)){var O=2*W*W*W-3*W*W+1,_=4*(i+U+(h+q)*s);D+=O*l[_+3],x+=O,!a&&l[_+3]<255&&(O=O*l[_+3]/255),b+=O*l[_],j+=O*l[_+1],S+=O*l[_+2],y+=O}}d[v]=b/y,d[v+1]=j/y,d[v+2]=S/y,d[v+3]=D/x}return e}function d(t,e){if(!e)return t;var i=t.framebufferWidth,h=t.framebufferHeight,r=t.pixelRatio,o=t.region,n=Math.min(S,b/Math.max(i,h));return n<j?t:a({},t,{framebufferWidth:Math.round(i*n),framebufferHeight:Math.round(h*n),pixelRatio:r*n,resample:{region:{x:Math.round(o.x*n),y:Math.round(o.y*n),width:Math.round(o.width*n),height:Math.round(o.height*n)},width:i,height:h}})}function g(t,e,a){return a||(a=w()),a.getContext("2d").createImageData(t,e)}function w(){return D||(D=document.createElement("canvas"),D.width=1,D.height=1),D}function c(t,e){if(!t)return e;var a=t.width,i=t.height;if(null!=a&&null!=i)return{width:Math.floor(a),height:Math.floor(i)};if(null==a&&null==i)return e;var h=e.width/e.height;return null==i?{width:Math.floor(a),height:Math.floor(a/h)}:{width:Math.floor(i*h),height:Math.floor(i)}}function m(t,e){var a=0,i=0,h=e.width,r=e.height;if(t&&t.area){a=Math.floor(t.area.x)||0,i=Math.floor(t.area.y)||0;var o=null!=t.area.width?Math.floor(t.area.width):null,n=null!=t.area.height?Math.floor(t.area.height):null;if(h-=a,r-=i,null!=o&&null!=n)h=Math.min(h,o),r=Math.min(r,n);else if(null==o&&null!=n){var l=Math.min(h,o);r*=l/h,h=l}else if(null!=o&&null==n){var f=Math.min(r,n);h*=f/r,r=f}}return s(M({x:a,y:i,width:h,height:r},t),e)}function s(t,e){var a=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),h=Math.floor(Math.min(t.width,e.width-a)),r=Math.floor(Math.min(t.height,e.height-i)),o={x:a,y:i,width:h,height:r},n=o.width/o.height,l=t.width/t.height;if(l===n)return o;if(l>n){var f=Math.floor(o.width/l),u=o.height-f;return{x:o.x,y:Math.floor(o.y+u/2),width:o.width,height:f}}var d=Math.floor(o.height*l),g=o.width-d;return{x:Math.floor(o.x+g/2),y:o.y,width:d,height:o.height}}function M(t,e){if(!e||null==e.width||null==e.height)return t;var a=e.width/e.height,i=t.width/t.height;return i===a?t:i<a?(t.width=Math.floor(t.height*a),t.height=t.height,t):(t.width=t.width,t.height=Math.floor(t.width/a),t)}function p(t){switch(t){case"png":case"jpg":case"jpeg":return t;case null:case void 0:return R;default:return i.neverReached(t),R}}function v(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function y(t){for(var e=t.data,a=e.length,i=0;i<a;i+=4){var h=e[i+3];if(h>0){var r=h/255;e[i+0]=e[i+0]/r,e[i+1]=e[i+1]/r,e[i+2]=e[i+2]/r}}}function x(t,e,a){return t<e?e:t>a?a:t}Object.defineProperty(e,"__esModule",{value:!0});var b=2048,j=1.5,S=8;e.completeUserSettings=h,e.toRenderSettings=r,e.encodeResult=o,e.toDataUrl=n,e.createEmptyImageData=l,e.wrapImageData=f,e.resampleHermite=u,e.screenshotSuperSampleSettings=d;var D=null,I=!0,q={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},R="jpg",C={png:100,jpg:98,jpeg:98},H={top:0,right:0,bottom:0,left:0}});